<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Fernando Cervantes (fernando.cervantes@jax.org)">
  <title>Advanced Machine Learning with Python workshop – Advanced Machine Learning with Python (Session 2 - Part 3)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-367017fa2871343a8466c6f0f2630bc9.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Advanced Machine Learning with Python (Session 2 - Part 3)</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Fernando Cervantes (fernando.cervantes@jax.org) 
</div>
</div>
</div>

</section>
<section id="materials" class="slide level2">
<h2>Materials</h2>
<p><a href="https://colab.research.google.com/gist/fercer/cdee0a8283df59b9e0f8bc04747b23f0/advanced_machine_learning_with_python_session_2_3.ipynb" class="btn btn-outline-primary" role="button" target="”_blank”">Open notebook in Colab</a></p>
</section>
<section>
<section id="setup" class="title-slide slide level1 center">
<h1>Setup</h1>
<pre><code>!pip install s3fs imagecodecs umap-learn torchmetrics</code></pre>
<div id="9bcb6b7e" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="op">!</span>git clone https:<span class="op">//</span>github.com<span class="op">/</span>jump<span class="op">-</span>cellpainting<span class="op">/</span>JUMP<span class="op">-</span>Target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cloning into 'JUMP-Target'...
remote: Enumerating objects: 243, done.
remote: Counting objects:   1% (1/78)remote: Counting objects:   2% (2/78)remote: Counting objects:   3% (3/78)remote: Counting objects:   5% (4/78)remote: Counting objects:   6% (5/78)remote: Counting objects:   7% (6/78)remote: Counting objects:   8% (7/78)remote: Counting objects:  10% (8/78)remote: Counting objects:  11% (9/78)remote: Counting objects:  12% (10/78)remote: Counting objects:  14% (11/78)remote: Counting objects:  15% (12/78)remote: Counting objects:  16% (13/78)remote: Counting objects:  17% (14/78)remote: Counting objects:  19% (15/78)remote: Counting objects:  20% (16/78)remote: Counting objects:  21% (17/78)remote: Counting objects:  23% (18/78)remote: Counting objects:  24% (19/78)remote: Counting objects:  25% (20/78)remote: Counting objects:  26% (21/78)remote: Counting objects:  28% (22/78)remote: Counting objects:  29% (23/78)remote: Counting objects:  30% (24/78)remote: Counting objects:  32% (25/78)remote: Counting objects:  33% (26/78)remote: Counting objects:  34% (27/78)remote: Counting objects:  35% (28/78)remote: Counting objects:  37% (29/78)remote: Counting objects:  38% (30/78)remote: Counting objects:  39% (31/78)remote: Counting objects:  41% (32/78)remote: Counting objects:  42% (33/78)remote: Counting objects:  43% (34/78)remote: Counting objects:  44% (35/78)remote: Counting objects:  46% (36/78)remote: Counting objects:  47% (37/78)remote: Counting objects:  48% (38/78)remote: Counting objects:  50% (39/78)remote: Counting objects:  51% (40/78)remote: Counting objects:  52% (41/78)remote: Counting objects:  53% (42/78)remote: Counting objects:  55% (43/78)remote: Counting objects:  56% (44/78)remote: Counting objects:  57% (45/78)remote: Counting objects:  58% (46/78)remote: Counting objects:  60% (47/78)remote: Counting objects:  61% (48/78)remote: Counting objects:  62% (49/78)remote: Counting objects:  64% (50/78)remote: Counting objects:  65% (51/78)remote: Counting objects:  66% (52/78)remote: Counting objects:  67% (53/78)remote: Counting objects:  69% (54/78)remote: Counting objects:  70% (55/78)remote: Counting objects:  71% (56/78)remote: Counting objects:  73% (57/78)remote: Counting objects:  74% (58/78)remote: Counting objects:  75% (59/78)remote: Counting objects:  76% (60/78)remote: Counting objects:  78% (61/78)remote: Counting objects:  79% (62/78)remote: Counting objects:  80% (63/78)remote: Counting objects:  82% (64/78)remote: Counting objects:  83% (65/78)remote: Counting objects:  84% (66/78)remote: Counting objects:  85% (67/78)remote: Counting objects:  87% (68/78)remote: Counting objects:  88% (69/78)remote: Counting objects:  89% (70/78)remote: Counting objects:  91% (71/78)remote: Counting objects:  92% (72/78)remote: Counting objects:  93% (73/78)remote: Counting objects:  94% (74/78)remote: Counting objects:  96% (75/78)remote: Counting objects:  97% (76/78)remote: Counting objects:  98% (77/78)remote: Counting objects: 100% (78/78)remote: Counting objects: 100% (78/78), done.
remote: Compressing objects:   1% (1/69)remote: Compressing objects:   2% (2/69)remote: Compressing objects:   4% (3/69)remote: Compressing objects:   5% (4/69)remote: Compressing objects:   7% (5/69)remote: Compressing objects:   8% (6/69)remote: Compressing objects:  10% (7/69)remote: Compressing objects:  11% (8/69)remote: Compressing objects:  13% (9/69)remote: Compressing objects:  14% (10/69)remote: Compressing objects:  15% (11/69)remote: Compressing objects:  17% (12/69)remote: Compressing objects:  18% (13/69)remote: Compressing objects:  20% (14/69)remote: Compressing objects:  21% (15/69)remote: Compressing objects:  23% (16/69)remote: Compressing objects:  24% (17/69)remote: Compressing objects:  26% (18/69)remote: Compressing objects:  27% (19/69)remote: Compressing objects:  28% (20/69)remote: Compressing objects:  30% (21/69)remote: Compressing objects:  31% (22/69)remote: Compressing objects:  33% (23/69)remote: Compressing objects:  34% (24/69)remote: Compressing objects:  36% (25/69)remote: Compressing objects:  37% (26/69)remote: Compressing objects:  39% (27/69)remote: Compressing objects:  40% (28/69)remote: Compressing objects:  42% (29/69)remote: Compressing objects:  43% (30/69)remote: Compressing objects:  44% (31/69)remote: Compressing objects:  46% (32/69)remote: Compressing objects:  47% (33/69)remote: Compressing objects:  49% (34/69)remote: Compressing objects:  50% (35/69)remote: Compressing objects:  52% (36/69)remote: Compressing objects:  53% (37/69)remote: Compressing objects:  55% (38/69)remote: Compressing objects:  56% (39/69)remote: Compressing objects:  57% (40/69)remote: Compressing objects:  59% (41/69)remote: Compressing objects:  60% (42/69)remote: Compressing objects:  62% (43/69)remote: Compressing objects:  63% (44/69)remote: Compressing objects:  65% (45/69)remote: Compressing objects:  66% (46/69)remote: Compressing objects:  68% (47/69)remote: Compressing objects:  69% (48/69)remote: Compressing objects:  71% (49/69)remote: Compressing objects:  72% (50/69)remote: Compressing objects:  73% (51/69)remote: Compressing objects:  75% (52/69)remote: Compressing objects:  76% (53/69)remote: Compressing objects:  78% (54/69)remote: Compressing objects:  79% (55/69)remote: Compressing objects:  81% (56/69)remote: Compressing objects:  82% (57/69)remote: Compressing objects:  84% (58/69)remote: Compressing objects:  85% (59/69)remote: Compressing objects:  86% (60/69)remote: Compressing objects:  88% (61/69)remote: Compressing objects:  89% (62/69)remote: Compressing objects:  91% (63/69)remote: Compressing objects:  92% (64/69)remote: Compressing objects:  94% (65/69)remote: Compressing objects:  95% (66/69)remote: Compressing objects:  97% (67/69)remote: Compressing objects:  98% (68/69)remote: Compressing objects: 100% (69/69)remote: Compressing objects: 100% (69/69), done.
Receiving objects:   0% (1/243)Receiving objects:   1% (3/243)Receiving objects:   2% (5/243)Receiving objects:   3% (8/243)Receiving objects:   4% (10/243)Receiving objects:   5% (13/243)Receiving objects:   6% (15/243)Receiving objects:   7% (18/243)Receiving objects:   8% (20/243)Receiving objects:   9% (22/243)Receiving objects:  10% (25/243)Receiving objects:  11% (27/243)Receiving objects:  12% (30/243)Receiving objects:  13% (32/243)Receiving objects:  14% (35/243)Receiving objects:  15% (37/243)Receiving objects:  16% (39/243)Receiving objects:  17% (42/243)Receiving objects:  18% (44/243)Receiving objects:  19% (47/243)Receiving objects:  20% (49/243)Receiving objects:  21% (52/243)Receiving objects:  22% (54/243)Receiving objects:  23% (56/243)Receiving objects:  24% (59/243)Receiving objects:  25% (61/243)Receiving objects:  26% (64/243)Receiving objects:  27% (66/243)Receiving objects:  28% (69/243)Receiving objects:  29% (71/243)Receiving objects:  30% (73/243)Receiving objects:  31% (76/243)Receiving objects:  32% (78/243)Receiving objects:  33% (81/243)Receiving objects:  34% (83/243)Receiving objects:  35% (86/243)Receiving objects:  36% (88/243)Receiving objects:  37% (90/243)Receiving objects:  38% (93/243)Receiving objects:  39% (95/243)Receiving objects:  40% (98/243)Receiving objects:  41% (100/243)Receiving objects:  42% (103/243)Receiving objects:  43% (105/243)Receiving objects:  44% (107/243)Receiving objects:  45% (110/243)Receiving objects:  46% (112/243)Receiving objects:  47% (115/243)Receiving objects:  48% (117/243)Receiving objects:  49% (120/243)Receiving objects:  50% (122/243)Receiving objects:  51% (124/243)Receiving objects:  52% (127/243)Receiving objects:  53% (129/243)Receiving objects:  54% (132/243)Receiving objects:  55% (134/243)Receiving objects:  56% (137/243)Receiving objects:  57% (139/243)Receiving objects:  58% (141/243)Receiving objects:  59% (144/243)Receiving objects:  60% (146/243)Receiving objects:  61% (149/243)Receiving objects:  62% (151/243)Receiving objects:  63% (154/243)Receiving objects:  64% (156/243)Receiving objects:  65% (158/243)Receiving objects:  66% (161/243)Receiving objects:  67% (163/243)Receiving objects:  68% (166/243)Receiving objects:  69% (168/243)Receiving objects:  70% (171/243)Receiving objects:  71% (173/243)Receiving objects:  72% (175/243)Receiving objects:  73% (178/243)Receiving objects:  74% (180/243)Receiving objects:  75% (183/243)Receiving objects:  76% (185/243)Receiving objects:  77% (188/243)Receiving objects:  78% (190/243)Receiving objects:  79% (192/243)Receiving objects:  80% (195/243)Receiving objects:  81% (197/243)Receiving objects:  82% (200/243)Receiving objects:  83% (202/243)Receiving objects:  84% (205/243)Receiving objects:  85% (207/243)Receiving objects:  86% (209/243)Receiving objects:  87% (212/243)Receiving objects:  88% (214/243)Receiving objects:  89% (217/243)Receiving objects:  90% (219/243)Receiving objects:  91% (222/243)Receiving objects:  92% (224/243)Receiving objects:  93% (226/243)Receiving objects:  94% (229/243)Receiving objects:  95% (231/243)remote: Total 243 (delta 40), reused 18 (delta 9), pack-reused 165 (from 1)
Receiving objects:  96% (234/243)Receiving objects:  97% (236/243)Receiving objects:  98% (239/243)Receiving objects:  99% (241/243)Receiving objects: 100% (243/243)Receiving objects: 100% (243/243), 289.62 KiB | 8.27 MiB/s, done.
Resolving deltas:   0% (0/133)Resolving deltas:   1% (2/133)Resolving deltas:   2% (3/133)Resolving deltas:   3% (4/133)Resolving deltas:   4% (6/133)Resolving deltas:   5% (7/133)Resolving deltas:   6% (8/133)Resolving deltas:   7% (10/133)Resolving deltas:   8% (11/133)Resolving deltas:   9% (12/133)Resolving deltas:  10% (14/133)Resolving deltas:  11% (15/133)Resolving deltas:  12% (16/133)Resolving deltas:  13% (18/133)Resolving deltas:  14% (19/133)Resolving deltas:  15% (20/133)Resolving deltas:  16% (22/133)Resolving deltas:  17% (23/133)Resolving deltas:  18% (24/133)Resolving deltas:  19% (26/133)Resolving deltas:  20% (27/133)Resolving deltas:  21% (28/133)Resolving deltas:  22% (30/133)Resolving deltas:  23% (31/133)Resolving deltas:  24% (32/133)Resolving deltas:  25% (34/133)Resolving deltas:  26% (35/133)Resolving deltas:  27% (36/133)Resolving deltas:  28% (38/133)Resolving deltas:  29% (39/133)Resolving deltas:  30% (40/133)Resolving deltas:  31% (42/133)Resolving deltas:  32% (43/133)Resolving deltas:  33% (44/133)Resolving deltas:  34% (46/133)Resolving deltas:  35% (47/133)Resolving deltas:  36% (48/133)Resolving deltas:  37% (50/133)Resolving deltas:  38% (51/133)Resolving deltas:  39% (52/133)Resolving deltas:  40% (54/133)Resolving deltas:  41% (55/133)Resolving deltas:  42% (56/133)Resolving deltas:  43% (58/133)Resolving deltas:  44% (59/133)Resolving deltas:  45% (60/133)Resolving deltas:  46% (62/133)Resolving deltas:  47% (63/133)Resolving deltas:  48% (64/133)Resolving deltas:  49% (66/133)Resolving deltas:  50% (67/133)Resolving deltas:  51% (68/133)Resolving deltas:  52% (70/133)Resolving deltas:  53% (71/133)Resolving deltas:  54% (72/133)Resolving deltas:  55% (74/133)Resolving deltas:  56% (75/133)Resolving deltas:  57% (76/133)Resolving deltas:  58% (78/133)Resolving deltas:  59% (79/133)Resolving deltas:  60% (80/133)Resolving deltas:  61% (82/133)Resolving deltas:  62% (83/133)Resolving deltas:  63% (84/133)Resolving deltas:  64% (86/133)Resolving deltas:  65% (87/133)Resolving deltas:  66% (88/133)Resolving deltas:  67% (90/133)Resolving deltas:  68% (91/133)Resolving deltas:  69% (92/133)Resolving deltas:  70% (94/133)Resolving deltas:  71% (95/133)Resolving deltas:  72% (96/133)Resolving deltas:  73% (98/133)Resolving deltas:  75% (100/133)Resolving deltas:  76% (102/133)Resolving deltas:  77% (103/133)Resolving deltas:  78% (104/133)Resolving deltas:  79% (106/133)Resolving deltas:  80% (107/133)Resolving deltas:  81% (108/133)Resolving deltas:  82% (110/133)Resolving deltas:  83% (111/133)Resolving deltas:  84% (112/133)Resolving deltas:  85% (114/133)Resolving deltas:  86% (115/133)Resolving deltas:  87% (116/133)Resolving deltas:  88% (118/133)Resolving deltas:  89% (119/133)Resolving deltas:  90% (120/133)Resolving deltas:  91% (122/133)Resolving deltas:  92% (123/133)Resolving deltas:  93% (124/133)Resolving deltas:  94% (126/133)Resolving deltas:  95% (127/133)Resolving deltas:  96% (128/133)Resolving deltas:  97% (130/133)Resolving deltas:  98% (131/133)Resolving deltas:  99% (132/133)Resolving deltas: 100% (133/133)Resolving deltas: 100% (133/133), done.</code></pre>
</div>
</div>
<div id="0a3cddc7" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="op">!</span>git clone https:<span class="op">//</span>github.com<span class="op">/</span>jump<span class="op">-</span>cellpainting<span class="op">/</span>datasets.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cloning into 'datasets'...
remote: Enumerating objects: 880, done.
remote: Counting objects:   0% (1/451)remote: Counting objects:   1% (5/451)remote: Counting objects:   2% (10/451)remote: Counting objects:   3% (14/451)remote: Counting objects:   4% (19/451)remote: Counting objects:   5% (23/451)remote: Counting objects:   6% (28/451)remote: Counting objects:   7% (32/451)remote: Counting objects:   8% (37/451)remote: Counting objects:   9% (41/451)remote: Counting objects:  10% (46/451)remote: Counting objects:  11% (50/451)remote: Counting objects:  12% (55/451)remote: Counting objects:  13% (59/451)remote: Counting objects:  14% (64/451)remote: Counting objects:  15% (68/451)remote: Counting objects:  16% (73/451)remote: Counting objects:  17% (77/451)remote: Counting objects:  18% (82/451)remote: Counting objects:  19% (86/451)remote: Counting objects:  20% (91/451)remote: Counting objects:  21% (95/451)remote: Counting objects:  22% (100/451)remote: Counting objects:  23% (104/451)remote: Counting objects:  24% (109/451)remote: Counting objects:  25% (113/451)remote: Counting objects:  26% (118/451)remote: Counting objects:  27% (122/451)remote: Counting objects:  28% (127/451)remote: Counting objects:  29% (131/451)remote: Counting objects:  30% (136/451)remote: Counting objects:  31% (140/451)remote: Counting objects:  32% (145/451)remote: Counting objects:  33% (149/451)remote: Counting objects:  34% (154/451)remote: Counting objects:  35% (158/451)remote: Counting objects:  36% (163/451)remote: Counting objects:  37% (167/451)remote: Counting objects:  38% (172/451)remote: Counting objects:  39% (176/451)remote: Counting objects:  40% (181/451)remote: Counting objects:  41% (185/451)remote: Counting objects:  42% (190/451)remote: Counting objects:  43% (194/451)remote: Counting objects:  44% (199/451)remote: Counting objects:  45% (203/451)remote: Counting objects:  46% (208/451)remote: Counting objects:  47% (212/451)remote: Counting objects:  48% (217/451)remote: Counting objects:  49% (221/451)remote: Counting objects:  50% (226/451)remote: Counting objects:  51% (231/451)remote: Counting objects:  52% (235/451)remote: Counting objects:  53% (240/451)remote: Counting objects:  54% (244/451)remote: Counting objects:  55% (249/451)remote: Counting objects:  56% (253/451)remote: Counting objects:  57% (258/451)remote: Counting objects:  58% (262/451)remote: Counting objects:  59% (267/451)remote: Counting objects:  60% (271/451)remote: Counting objects:  61% (276/451)remote: Counting objects:  62% (280/451)remote: Counting objects:  63% (285/451)remote: Counting objects:  64% (289/451)remote: Counting objects:  65% (294/451)remote: Counting objects:  66% (298/451)remote: Counting objects:  67% (303/451)remote: Counting objects:  68% (307/451)remote: Counting objects:  69% (312/451)remote: Counting objects:  70% (316/451)remote: Counting objects:  71% (321/451)remote: Counting objects:  72% (325/451)remote: Counting objects:  73% (330/451)remote: Counting objects:  74% (334/451)remote: Counting objects:  75% (339/451)remote: Counting objects:  76% (343/451)remote: Counting objects:  77% (348/451)remote: Counting objects:  78% (352/451)remote: Counting objects:  79% (357/451)remote: Counting objects:  80% (361/451)remote: Counting objects:  81% (366/451)remote: Counting objects:  82% (370/451)remote: Counting objects:  83% (375/451)remote: Counting objects:  84% (379/451)remote: Counting objects:  85% (384/451)remote: Counting objects:  86% (388/451)remote: Counting objects:  87% (393/451)remote: Counting objects:  88% (397/451)remote: Counting objects:  89% (402/451)remote: Counting objects:  90% (406/451)remote: Counting objects:  91% (411/451)remote: Counting objects:  92% (415/451)remote: Counting objects:  93% (420/451)remote: Counting objects:  94% (424/451)remote: Counting objects:  95% (429/451)remote: Counting objects:  96% (433/451)remote: Counting objects:  97% (438/451)remote: Counting objects:  98% (442/451)remote: Counting objects:  99% (447/451)remote: Counting objects: 100% (451/451)remote: Counting objects: 100% (451/451), done.
remote: Compressing objects:   0% (1/166)remote: Compressing objects:   1% (2/166)remote: Compressing objects:   2% (4/166)remote: Compressing objects:   3% (5/166)remote: Compressing objects:   4% (7/166)remote: Compressing objects:   5% (9/166)remote: Compressing objects:   6% (10/166)remote: Compressing objects:   7% (12/166)remote: Compressing objects:   8% (14/166)remote: Compressing objects:   9% (15/166)remote: Compressing objects:  10% (17/166)remote: Compressing objects:  11% (19/166)remote: Compressing objects:  12% (20/166)remote: Compressing objects:  13% (22/166)remote: Compressing objects:  14% (24/166)remote: Compressing objects:  15% (25/166)remote: Compressing objects:  16% (27/166)remote: Compressing objects:  17% (29/166)remote: Compressing objects:  18% (30/166)remote: Compressing objects:  19% (32/166)remote: Compressing objects:  20% (34/166)remote: Compressing objects:  21% (35/166)remote: Compressing objects:  22% (37/166)remote: Compressing objects:  23% (39/166)remote: Compressing objects:  24% (40/166)remote: Compressing objects:  25% (42/166)remote: Compressing objects:  26% (44/166)remote: Compressing objects:  27% (45/166)remote: Compressing objects:  28% (47/166)remote: Compressing objects:  29% (49/166)remote: Compressing objects:  30% (50/166)remote: Compressing objects:  31% (52/166)remote: Compressing objects:  32% (54/166)remote: Compressing objects:  33% (55/166)remote: Compressing objects:  34% (57/166)remote: Compressing objects:  35% (59/166)remote: Compressing objects:  36% (60/166)remote: Compressing objects:  37% (62/166)remote: Compressing objects:  38% (64/166)remote: Compressing objects:  39% (65/166)remote: Compressing objects:  40% (67/166)remote: Compressing objects:  41% (69/166)remote: Compressing objects:  42% (70/166)remote: Compressing objects:  43% (72/166)remote: Compressing objects:  44% (74/166)remote: Compressing objects:  45% (75/166)remote: Compressing objects:  46% (77/166)remote: Compressing objects:  47% (79/166)remote: Compressing objects:  48% (80/166)remote: Compressing objects:  49% (82/166)remote: Compressing objects:  50% (83/166)remote: Compressing objects:  51% (85/166)remote: Compressing objects:  52% (87/166)remote: Compressing objects:  53% (88/166)remote: Compressing objects:  54% (90/166)remote: Compressing objects:  55% (92/166)remote: Compressing objects:  56% (93/166)remote: Compressing objects:  57% (95/166)remote: Compressing objects:  58% (97/166)remote: Compressing objects:  59% (98/166)remote: Compressing objects:  60% (100/166)remote: Compressing objects:  61% (102/166)remote: Compressing objects:  62% (103/166)remote: Compressing objects:  63% (105/166)remote: Compressing objects:  64% (107/166)remote: Compressing objects:  65% (108/166)remote: Compressing objects:  66% (110/166)remote: Compressing objects:  67% (112/166)remote: Compressing objects:  68% (113/166)remote: Compressing objects:  69% (115/166)remote: Compressing objects:  70% (117/166)remote: Compressing objects:  71% (118/166)remote: Compressing objects:  72% (120/166)remote: Compressing objects:  73% (122/166)remote: Compressing objects:  74% (123/166)remote: Compressing objects:  75% (125/166)remote: Compressing objects:  76% (127/166)remote: Compressing objects:  77% (128/166)remote: Compressing objects:  78% (130/166)remote: Compressing objects:  79% (132/166)remote: Compressing objects:  80% (133/166)remote: Compressing objects:  81% (135/166)remote: Compressing objects:  82% (137/166)remote: Compressing objects:  83% (138/166)remote: Compressing objects:  84% (140/166)remote: Compressing objects:  85% (142/166)remote: Compressing objects:  86% (143/166)remote: Compressing objects:  87% (145/166)remote: Compressing objects:  88% (147/166)remote: Compressing objects:  89% (148/166)remote: Compressing objects:  90% (150/166)remote: Compressing objects:  91% (152/166)remote: Compressing objects:  92% (153/166)remote: Compressing objects:  93% (155/166)remote: Compressing objects:  94% (157/166)remote: Compressing objects:  95% (158/166)remote: Compressing objects:  96% (160/166)remote: Compressing objects:  97% (162/166)remote: Compressing objects:  98% (163/166)remote: Compressing objects:  99% (165/166)remote: Compressing objects: 100% (166/166)remote: Compressing objects: 100% (166/166), done.
Receiving objects:   0% (1/880)Receiving objects:   1% (9/880)Receiving objects:   2% (18/880)Receiving objects:   3% (27/880)Receiving objects:   4% (36/880)Receiving objects:   5% (44/880)Receiving objects:   6% (53/880)Receiving objects:   7% (62/880)Receiving objects:   8% (71/880)Receiving objects:   9% (80/880)Receiving objects:  10% (88/880)Receiving objects:  11% (97/880)Receiving objects:  12% (106/880)Receiving objects:  13% (115/880)Receiving objects:  14% (124/880)Receiving objects:  15% (132/880)Receiving objects:  16% (141/880)Receiving objects:  17% (150/880)Receiving objects:  18% (159/880)Receiving objects:  19% (168/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  20% (176/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  21% (185/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  22% (194/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  23% (203/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  24% (212/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  25% (220/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  26% (229/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  27% (238/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  28% (247/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  29% (256/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  30% (264/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  31% (273/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  32% (282/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  33% (291/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  34% (300/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  35% (308/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  36% (317/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  37% (326/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  38% (335/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  39% (344/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  40% (352/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  41% (361/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  42% (370/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  43% (379/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  44% (388/880), 35.34 MiB | 70.80 MiB/sReceiving objects:  44% (388/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  45% (396/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  46% (405/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  47% (414/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  48% (423/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  49% (432/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  50% (440/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  51% (449/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  52% (458/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  53% (467/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  54% (476/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  55% (484/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  56% (493/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  57% (502/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  58% (511/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  59% (520/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  60% (528/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  61% (537/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  62% (546/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  63% (555/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  64% (564/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  65% (572/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  66% (581/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  67% (590/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  68% (599/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  69% (608/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  70% (616/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  71% (625/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  72% (634/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  73% (643/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  74% (652/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  75% (660/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  76% (669/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  77% (678/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  78% (687/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  79% (696/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  80% (704/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  81% (713/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  82% (722/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  83% (731/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  84% (740/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  85% (748/880), 75.67 MiB | 75.73 MiB/sremote: Total 880 (delta 342), reused 310 (delta 279), pack-reused 429 (from 1)
Receiving objects:  86% (757/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  87% (766/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  88% (775/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  89% (784/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  90% (792/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  91% (801/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  92% (810/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  93% (819/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  94% (828/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  95% (836/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  96% (845/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  97% (854/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  98% (863/880), 75.67 MiB | 75.73 MiB/sReceiving objects:  99% (872/880), 75.67 MiB | 75.73 MiB/sReceiving objects: 100% (880/880), 75.67 MiB | 75.73 MiB/sReceiving objects: 100% (880/880), 91.91 MiB | 79.02 MiB/s, done.
Resolving deltas:   0% (0/457)Resolving deltas:   1% (5/457)Resolving deltas:   2% (10/457)Resolving deltas:   3% (14/457)Resolving deltas:   4% (19/457)Resolving deltas:   5% (23/457)Resolving deltas:   6% (28/457)Resolving deltas:   7% (32/457)Resolving deltas:   8% (37/457)Resolving deltas:   9% (42/457)Resolving deltas:  10% (46/457)Resolving deltas:  11% (51/457)Resolving deltas:  12% (55/457)Resolving deltas:  13% (60/457)Resolving deltas:  14% (64/457)Resolving deltas:  15% (69/457)Resolving deltas:  16% (74/457)Resolving deltas:  17% (78/457)Resolving deltas:  18% (83/457)Resolving deltas:  19% (87/457)Resolving deltas:  20% (92/457)Resolving deltas:  21% (96/457)Resolving deltas:  22% (101/457)Resolving deltas:  23% (106/457)Resolving deltas:  24% (110/457)Resolving deltas:  25% (115/457)Resolving deltas:  26% (119/457)Resolving deltas:  27% (124/457)Resolving deltas:  28% (129/457)Resolving deltas:  29% (133/457)Resolving deltas:  30% (138/457)Resolving deltas:  31% (142/457)Resolving deltas:  32% (147/457)Resolving deltas:  33% (151/457)Resolving deltas:  34% (156/457)Resolving deltas:  35% (161/457)Resolving deltas:  36% (165/457)Resolving deltas:  37% (170/457)Resolving deltas:  38% (174/457)Resolving deltas:  39% (179/457)Resolving deltas:  40% (183/457)Resolving deltas:  41% (188/457)Resolving deltas:  42% (192/457)Resolving deltas:  43% (197/457)Resolving deltas:  44% (202/457)Resolving deltas:  45% (206/457)Resolving deltas:  46% (212/457)Resolving deltas:  47% (215/457)Resolving deltas:  48% (220/457)Resolving deltas:  49% (224/457)Resolving deltas:  50% (229/457)Resolving deltas:  51% (234/457)Resolving deltas:  52% (238/457)Resolving deltas:  53% (243/457)Resolving deltas:  54% (247/457)Resolving deltas:  55% (252/457)Resolving deltas:  56% (256/457)Resolving deltas:  57% (261/457)Resolving deltas:  58% (266/457)Resolving deltas:  59% (270/457)Resolving deltas:  60% (275/457)Resolving deltas:  61% (279/457)Resolving deltas:  62% (285/457)Resolving deltas:  63% (288/457)Resolving deltas:  64% (293/457)Resolving deltas:  65% (298/457)Resolving deltas:  66% (302/457)Resolving deltas:  67% (307/457)Resolving deltas:  68% (311/457)Resolving deltas:  69% (316/457)Resolving deltas:  70% (320/457)Resolving deltas:  71% (325/457)Resolving deltas:  72% (330/457)Resolving deltas:  73% (334/457)Resolving deltas:  74% (339/457)Resolving deltas:  75% (343/457)Resolving deltas:  76% (348/457)Resolving deltas:  77% (352/457)Resolving deltas:  78% (357/457)Resolving deltas:  79% (362/457)Resolving deltas:  80% (366/457)Resolving deltas:  81% (371/457)Resolving deltas:  82% (375/457)Resolving deltas:  83% (380/457)Resolving deltas:  84% (384/457)Resolving deltas:  85% (389/457)Resolving deltas:  86% (394/457)Resolving deltas:  87% (398/457)Resolving deltas:  88% (403/457)Resolving deltas:  89% (407/457)Resolving deltas:  90% (412/457)Resolving deltas:  91% (416/457)Resolving deltas:  92% (421/457)Resolving deltas:  93% (426/457)Resolving deltas:  94% (430/457)Resolving deltas:  95% (435/457)Resolving deltas:  96% (439/457)Resolving deltas:  97% (444/457)Resolving deltas:  98% (448/457)Resolving deltas:  99% (453/457)Resolving deltas: 100% (457/457)Resolving deltas: 100% (457/457), done.</code></pre>
</div>
</div>
</section>
<section id="review-the-metadata-of-the-cpg0016-jump-dataset" class="slide level2 scrollable">
<h2>Review the <code>metadata</code> of the <code>cpg0016-jump</code> dataset</h2>
<ul class="task-list">
<li><label><input type="checkbox">Load the plate-level metadata from the <code>jump-cellpainting/datasets</code> repository</label></li>
</ul>
<div id="7055e979" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="efc7099b" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>jump_plates_metadata <span class="op">=</span> pd.read_csv(<span class="st">"datasets/metadata/plate.csv.gz"</span>)</span>
<span id="cb7-2"><a></a>jump_plates_metadata[<span class="st">"Metadata_PlateType"</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array(['COMPOUND_EMPTY', 'COMPOUND', 'DMSO', 'TARGET2', 'CRISPR', 'ORF',
       'TARGET1', 'POSCON8'], dtype=object)</code></pre>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Inspect the structure of the database</label></li>
</ul>
<div id="916fa75b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>jump_plates_metadata.groupby([<span class="st">"Metadata_Source"</span>, <span class="st">"Metadata_Batch"</span>]).describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

  <div id="df-6ccfbbf9-9290-4af2-886f-e009c389b77c" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">Metadata_Plate</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">Metadata_PlateType</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">unique</th>
<th data-quarto-table-cell-role="th">top</th>
<th data-quarto-table-cell-role="th">freq</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">unique</th>
<th data-quarto-table-cell-role="th">top</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Metadata_Source</th>
<th data-quarto-table-cell-role="th">Metadata_Batch</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">source_1</td>
<td data-quarto-table-cell-role="th">Batch1_20221004</td>
<td>9</td>
<td>9</td>
<td>UL000109</td>
<td>1</td>
<td>9</td>
<td>2</td>
<td>COMPOUND</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Batch2_20221006</td>
<td>7</td>
<td>7</td>
<td>UL001647</td>
<td>1</td>
<td>7</td>
<td>1</td>
<td>COMPOUND</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Batch3_20221010</td>
<td>8</td>
<td>8</td>
<td>UL000087</td>
<td>1</td>
<td>8</td>
<td>1</td>
<td>COMPOUND</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Batch4_20221012</td>
<td>8</td>
<td>8</td>
<td>UL000081</td>
<td>1</td>
<td>8</td>
<td>1</td>
<td>COMPOUND</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Batch5_20221030</td>
<td>11</td>
<td>11</td>
<td>UL000561</td>
<td>1</td>
<td>11</td>
<td>2</td>
<td>COMPOUND</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">source_9</td>
<td data-quarto-table-cell-role="th">20210918-Run11</td>
<td>9</td>
<td>9</td>
<td>GR00004367</td>
<td>1</td>
<td>9</td>
<td>2</td>
<td>COMPOUND</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20210918-Run12</td>
<td>8</td>
<td>8</td>
<td>GR00004377</td>
<td>1</td>
<td>8</td>
<td>1</td>
<td>COMPOUND</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20211013-Run14</td>
<td>13</td>
<td>13</td>
<td>GR00003279</td>
<td>1</td>
<td>13</td>
<td>2</td>
<td>COMPOUND</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20211102-Run15</td>
<td>11</td>
<td>11</td>
<td>GR00004391</td>
<td>1</td>
<td>11</td>
<td>2</td>
<td>COMPOUND</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20211103-Run16</td>
<td>17</td>
<td>17</td>
<td>GR00004405</td>
<td>1</td>
<td>17</td>
<td>2</td>
<td>COMPOUND</td>
<td>16</td>
</tr>
</tbody>
</table>

<p>149 rows × 8 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-6ccfbbf9-9290-4af2-886f-e009c389b77c')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-6ccfbbf9-9290-4af2-886f-e009c389b77c button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-6ccfbbf9-9290-4af2-886f-e009c389b77c');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section>
<section id="subset-the-dataset-to-extract-samples-with-crispr-orf-and-nonedmso-treatments" class="slide level2 scrollable">
<h2>Subset the dataset to extract samples with <em>CRISPR</em>, <em>ORF</em>, and <em>NONE/DMSO</em> treatments</h2>
<ul class="task-list">
<li><label><input type="checkbox">Read the <em>CRISPR</em> plate maps from the <code>JUMP-Target</code> repository</label></li>
</ul>
<div id="e3fc7db5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>crispr_wells_metadata <span class="op">=</span> pd.read_csv(<span class="st">"JUMP-Target/JUMP-Target-1_crispr_platemap.tsv"</span>, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Add one column to identify the type of treatment, and other to assign a numeric label (<em>CRISPR</em> = 1)</label></li>
</ul>
<div id="bfc7960c" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>crispr_wells_metadata[<span class="st">"Plate_type"</span>] <span class="op">=</span> <span class="st">"CRISPR"</span></span>
<span id="cb11-2"><a></a>crispr_wells_metadata[<span class="st">"Plate_label"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-3"><a></a>crispr_wells_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

  <div id="df-59e0bf09-6bf4-4dca-93d3-0e96943e47d7" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">well_position</th>
<th data-quarto-table-cell-role="th">broad_sample</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A01</td>
<td>BRDN0001480888</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A02</td>
<td>BRDN0001483495</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A03</td>
<td>BRDN0001147364</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>A04</td>
<td>BRDN0001490272</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>A05</td>
<td>BRDN0001480510</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">379</td>
<td>P20</td>
<td>BRDN0001145303</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">380</td>
<td>P21</td>
<td>BRDN0001484228</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">381</td>
<td>P22</td>
<td>BRDN0001487618</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">382</td>
<td>P23</td>
<td>BRDN0001487864</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">383</td>
<td>P24</td>
<td>BRDN0000735603</td>
<td>CRISPR</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>384 rows × 4 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-59e0bf09-6bf4-4dca-93d3-0e96943e47d7')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-59e0bf09-6bf4-4dca-93d3-0e96943e47d7 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-59e0bf09-6bf4-4dca-93d3-0e96943e47d7');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section>
<section id="subset-the-dataset-to-extract-samples-with-crispr-orf-and-nonedmso-treatments-1" class="slide level2 scrollable">
<h2>Subset the dataset to extract samples with <em>CRISPR</em>, <em>ORF</em>, and <em>NONE/DMSO</em> treatments</h2>
<ul class="task-list">
<li><label><input type="checkbox">Read the <em>ORF</em> plate maps from the <code>JUMP-Target</code> repository</label></li>
</ul>
<div id="d8db3b3b" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>orf_wells_metadata <span class="op">=</span> pd.read_csv(<span class="st">"JUMP-Target/JUMP-Target-1_orf_platemap.tsv"</span>, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Add one column to identify the type of treatment, and other to assign a numeric label (<em>ORF</em> = 2)</label></li>
</ul>
<div id="04a301e3" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>orf_wells_metadata[<span class="st">"Plate_type"</span>] <span class="op">=</span> <span class="st">"ORF"</span></span>
<span id="cb13-2"><a></a>orf_wells_metadata[<span class="st">"Plate_label"</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb13-3"><a></a>orf_wells_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

  <div id="df-d57e6e3b-ee1e-4bb0-8478-6df27bf75069" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">well_position</th>
<th data-quarto-table-cell-role="th">broad_sample</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A01</td>
<td>ccsbBroad304_00900</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A02</td>
<td>ccsbBroad304_07795</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A03</td>
<td>ccsbBroad304_02826</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>A04</td>
<td>ccsbBroad304_01492</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>A05</td>
<td>ccsbBroad304_00691</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">379</td>
<td>P20</td>
<td>ccsbBroad304_00277</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">380</td>
<td>P21</td>
<td>ccsbBroad304_06464</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">381</td>
<td>P22</td>
<td>ccsbBroad304_00476</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">382</td>
<td>P23</td>
<td>ccsbBroad304_01649</td>
<td>ORF</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">383</td>
<td>P24</td>
<td>ccsbBroad304_03934</td>
<td>ORF</td>
<td>2</td>
</tr>
</tbody>
</table>

<p>384 rows × 4 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-d57e6e3b-ee1e-4bb0-8478-6df27bf75069')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-d57e6e3b-ee1e-4bb0-8478-6df27bf75069 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-d57e6e3b-ee1e-4bb0-8478-6df27bf75069');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section>
<section id="subset-the-dataset-to-extract-samples-with-crispr-orf-and-nonedmso-treatments-2" class="slide level2 scrollable">
<h2>Subset the dataset to extract samples with <em>CRISPR</em>, <em>ORF</em>, and <em>NONE/DMSO</em> treatments</h2>
<ul class="task-list">
<li><label><input type="checkbox">Read the <em>COMPOUND</em> plate maps from the <code>JUMP-Target</code> repository</label></li>
</ul>
<div id="4f079458" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>compound_wells_metadata <span class="op">=</span> pd.read_csv(<span class="st">"JUMP-Target/JUMP-Target-1_compound_platemap.tsv"</span>, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Add one column to identify the type of treatment, and other to assign a numeric label (<em>COMPOUND</em> = 3)</label></li>
</ul>
<div id="510bd7fd" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>compound_wells_metadata[<span class="st">"Plate_type"</span>] <span class="op">=</span> <span class="st">"COMPOUND"</span></span>
<span id="cb15-2"><a></a>compound_wells_metadata[<span class="st">"Plate_label"</span>] <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb15-3"><a></a>compound_wells_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

  <div id="df-7e94d6f9-1da6-4cf9-8015-777f9d5398ef" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">well_position</th>
<th data-quarto-table-cell-role="th">broad_sample</th>
<th data-quarto-table-cell-role="th">solvent</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A01</td>
<td>BRD-A86665761-001-01-1</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A02</td>
<td>NaN</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A03</td>
<td>BRD-A22032524-074-09-9</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>A04</td>
<td>BRD-A01078468-001-14-8</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>A05</td>
<td>BRD-K48278478-001-01-2</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">379</td>
<td>P20</td>
<td>BRD-K68982262-001-01-4</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">380</td>
<td>P21</td>
<td>BRD-K24616672-003-20-1</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">381</td>
<td>P22</td>
<td>BRD-A82396632-008-30-8</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">382</td>
<td>P23</td>
<td>BRD-K61250553-003-30-6</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">383</td>
<td>P24</td>
<td>BRD-K70358946-001-17-3</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
</tbody>
</table>

<p>384 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-7e94d6f9-1da6-4cf9-8015-777f9d5398ef')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-7e94d6f9-1da6-4cf9-8015-777f9d5398ef button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-7e94d6f9-1da6-4cf9-8015-777f9d5398ef');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section>
<section id="subset-the-dataset-to-extract-samples-with-crispr-orf-and-nonedmso-treatments-3" class="slide level2 scrollable">
<h2>Subset the dataset to extract samples with <em>CRISPR</em>, <em>ORF</em>, and <em>NONE/DMSO</em> treatments</h2>
<ul class="task-list">
<li><label><input type="checkbox">Concatenate the three tables into a single table</label></li>
</ul>
<div id="54231686" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a>wells_metadata <span class="op">=</span> pd.concat([compound_wells_metadata, orf_wells_metadata, crispr_wells_metadata])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Change the label of the well positions that were not treated with any compound (<em>NONE/DMSO</em> = 0)</label></li>
</ul>
<div id="3763b687" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a>wells_metadata.loc[wells_metadata[<span class="st">"broad_sample"</span>].isna(), <span class="st">"Plate_label"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-2"><a></a>wells_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

  <div id="df-2b583fe8-6f4e-4de5-ba7b-20223daca887" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">well_position</th>
<th data-quarto-table-cell-role="th">broad_sample</th>
<th data-quarto-table-cell-role="th">solvent</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A01</td>
<td>BRD-A86665761-001-01-1</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A02</td>
<td>NaN</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A03</td>
<td>BRD-A22032524-074-09-9</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>A04</td>
<td>BRD-A01078468-001-14-8</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>A05</td>
<td>BRD-K48278478-001-01-2</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">379</td>
<td>P20</td>
<td>BRDN0001145303</td>
<td>NaN</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">380</td>
<td>P21</td>
<td>BRDN0001484228</td>
<td>NaN</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">381</td>
<td>P22</td>
<td>BRDN0001487618</td>
<td>NaN</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">382</td>
<td>P23</td>
<td>BRDN0001487864</td>
<td>NaN</td>
<td>CRISPR</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">383</td>
<td>P24</td>
<td>BRDN0000735603</td>
<td>NaN</td>
<td>CRISPR</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>1152 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-2b583fe8-6f4e-4de5-ba7b-20223daca887')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-2b583fe8-6f4e-4de5-ba7b-20223daca887 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-2b583fe8-6f4e-4de5-ba7b-20223daca887');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section>
<section id="get-the-url-of-each-assay-plate-from-the-s3-bucket" class="slide level2 scrollable">
<h2>Get the URL of each assay plate from the S3 bucket</h2>
<ul class="task-list">
<li><label><input type="checkbox">List the plates in the <code>cellpainting-gallery/cpg0016-jump</code> bucket</label></li>
</ul>
<div id="1416a081" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="im">import</span> s3fs</span>
<span id="cb18-2"><a></a></span>
<span id="cb18-3"><a></a>fs <span class="op">=</span> s3fs.S3FileSystem(anon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-4"><a></a></span>
<span id="cb18-5"><a></a>batch_names <span class="op">=</span> {}</span>
<span id="cb18-6"><a></a>plate_paths <span class="op">=</span> {}</span>
<span id="cb18-7"><a></a>source_names <span class="op">=</span> {}</span>
<span id="cb18-8"><a></a>plate_types <span class="op">=</span> {}</span>
<span id="cb18-9"><a></a></span>
<span id="cb18-10"><a></a><span class="cf">for</span> _, src_row <span class="kw">in</span> jump_plates_metadata.groupby([<span class="st">"Metadata_Source"</span>, <span class="st">"Metadata_Batch"</span>]).describe().iterrows():</span>
<span id="cb18-11"><a></a>    source_name, batch_name <span class="op">=</span> src_row.name</span>
<span id="cb18-12"><a></a></span>
<span id="cb18-13"><a></a>    <span class="co"># Ignore 'source_8' since the naming of the images is not standard</span></span>
<span id="cb18-14"><a></a>    <span class="cf">if</span> source_name <span class="kw">in</span> [<span class="st">"source_8"</span>]:</span>
<span id="cb18-15"><a></a>        <span class="cf">continue</span></span>
<span id="cb18-16"><a></a></span>
<span id="cb18-17"><a></a>    plate_type <span class="op">=</span> src_row[<span class="st">"Metadata_PlateType"</span>].top</span>
<span id="cb18-18"><a></a></span>
<span id="cb18-19"><a></a>    <span class="cf">for</span> plate_path <span class="kw">in</span> fs.ls(<span class="ss">f"cellpainting-gallery/cpg0016-jump/</span><span class="sc">{</span>source_name<span class="sc">}</span><span class="ss">/images/</span><span class="sc">{</span>batch_name<span class="sc">}</span><span class="ss">/images/"</span>):</span>
<span id="cb18-20"><a></a>        plate_path <span class="op">=</span> plate_path.split(<span class="st">"/"</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb18-21"><a></a>        <span class="cf">if</span> <span class="kw">not</span> plate_path:</span>
<span id="cb18-22"><a></a>            <span class="cf">continue</span></span>
<span id="cb18-23"><a></a></span>
<span id="cb18-24"><a></a>        plate_name <span class="op">=</span> plate_path.split(<span class="st">"__"</span>)[<span class="dv">0</span>]</span>
<span id="cb18-25"><a></a></span>
<span id="cb18-26"><a></a>        source_names[plate_name] <span class="op">=</span> source_name</span>
<span id="cb18-27"><a></a>        batch_names[plate_name] <span class="op">=</span> batch_name</span>
<span id="cb18-28"><a></a>        plate_types[plate_name] <span class="op">=</span> plate_type</span>
<span id="cb18-29"><a></a>        plate_paths[plate_name] <span class="op">=</span> plate_path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="get-the-url-of-each-assay-plate-from-the-s3-bucket-1" class="slide level2 scrollable">
<h2>Get the URL of each assay plate from the S3 bucket</h2>
<ul class="task-list">
<li><label><input type="checkbox">Create a <code>pandas</code> data frame to associate each plate to its location within the S3 bucket</label></li>
</ul>
<div id="1b7dee7e" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a>plate_maps <span class="op">=</span> pd.DataFrame()</span>
<span id="cb19-2"><a></a></span>
<span id="cb19-3"><a></a>plate_maps[<span class="st">"Plate_name"</span>] <span class="op">=</span> batch_names.keys()</span>
<span id="cb19-4"><a></a>plate_maps[<span class="st">"Source_name"</span>] <span class="op">=</span> plate_maps[<span class="st">"Plate_name"</span>].<span class="bu">map</span>(source_names)</span>
<span id="cb19-5"><a></a>plate_maps[<span class="st">"Batch_name"</span>] <span class="op">=</span> plate_maps[<span class="st">"Plate_name"</span>].<span class="bu">map</span>(batch_names)</span>
<span id="cb19-6"><a></a>plate_maps[<span class="st">"Plate_type"</span>] <span class="op">=</span> plate_maps[<span class="st">"Plate_name"</span>].<span class="bu">map</span>(plate_types)</span>
<span id="cb19-7"><a></a>plate_maps[<span class="st">"Plate_path"</span>] <span class="op">=</span> plate_maps[<span class="st">"Plate_name"</span>].<span class="bu">map</span>(plate_paths)</span>
<span id="cb19-8"><a></a></span>
<span id="cb19-9"><a></a>plate_maps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

  <div id="df-693094a1-c76b-40ce-9ac8-22068ae6bed3" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Plate_name</th>
<th data-quarto-table-cell-role="th">Source_name</th>
<th data-quarto-table-cell-role="th">Batch_name</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>UL000109</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL000109__2022-10-05T06_35_06-Measurement1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>UL001641</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001641__2022-10-04T23_16_28-Measurement1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>UL001643</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001643__2022-10-04T18_52_42-Measurement2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>UL001645</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001645__2022-10-05T00_44_11-Measurement1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>UL001651</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001651__2022-10-04T20_20_52-Measurement1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2333</td>
<td>GR00004417</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004417</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2334</td>
<td>GR00004418</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2335</td>
<td>GR00004419</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004419</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2336</td>
<td>GR00004420</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004420</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2337</td>
<td>GR00004421</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004421</td>
</tr>
</tbody>
</table>

<p>2338 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-693094a1-c76b-40ce-9ac8-22068ae6bed3')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-693094a1-c76b-40ce-9ac8-22068ae6bed3 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-693094a1-c76b-40ce-9ac8-22068ae6bed3');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section>
<section id="subset-the-data-frame-to-separate-perturbation-crisprorfnone-plates-from-compound-plates" class="slide level2 scrollable">
<h2>Subset the data frame to separate perturbation (<em>CRISPR/ORF/NONE</em>) plates from <em>COMPOUND</em> plates</h2>
<ul class="task-list">
<li><label><input type="checkbox">Subset the <em>COMPOUND</em> plates</label></li>
</ul>
<div id="6282f0c2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a>comp_plate_maps <span class="op">=</span> plate_maps.query(<span class="st">"Plate_type=='COMPOUND'"</span>)</span>
<span id="cb20-2"><a></a>comp_plate_maps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

  <div id="df-496607a4-7041-47f2-b05e-54dfbeaed6f7" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Plate_name</th>
<th data-quarto-table-cell-role="th">Source_name</th>
<th data-quarto-table-cell-role="th">Batch_name</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>UL000109</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL000109__2022-10-05T06_35_06-Measurement1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>UL001641</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001641__2022-10-04T23_16_28-Measurement1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>UL001643</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001643__2022-10-04T18_52_42-Measurement2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>UL001645</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001645__2022-10-05T00_44_11-Measurement1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>UL001651</td>
<td>source_1</td>
<td>Batch1_20221004</td>
<td>COMPOUND</td>
<td>UL001651__2022-10-04T20_20_52-Measurement1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2333</td>
<td>GR00004417</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004417</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2334</td>
<td>GR00004418</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2335</td>
<td>GR00004419</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004419</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2336</td>
<td>GR00004420</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004420</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2337</td>
<td>GR00004421</td>
<td>source_9</td>
<td>20211103-Run16</td>
<td>COMPOUND</td>
<td>GR00004421</td>
</tr>
</tbody>
</table>

<p>1905 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-496607a4-7041-47f2-b05e-54dfbeaed6f7')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-496607a4-7041-47f2-b05e-54dfbeaed6f7 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-496607a4-7041-47f2-b05e-54dfbeaed6f7');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Subset the <em>CRISPR/ORF/DMSO</em> plates</label></li>
</ul>
<div id="e28b71f9" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a>pert_plate_maps <span class="op">=</span> plate_maps[plate_maps[<span class="st">"Plate_type"</span>].isin([<span class="st">"CRISPR"</span>, <span class="st">"ORF"</span>, <span class="st">"DMSO"</span>])]</span>
<span id="cb21-2"><a></a>pert_plate_maps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

  <div id="df-90806d63-2489-49a7-997b-7ab9dbde3d27" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Plate_name</th>
<th data-quarto-table-cell-role="th">Source_name</th>
<th data-quarto-table-cell-role="th">Batch_name</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>Dest210628-161651</td>
<td>source_10</td>
<td>2021_06_28_U2OS_48_hr_run9</td>
<td>DMSO</td>
<td>Dest210628-161651</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">143</td>
<td>Dest210628-162003</td>
<td>source_10</td>
<td>2021_06_28_U2OS_48_hr_run9</td>
<td>DMSO</td>
<td>Dest210628-162003</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">457</td>
<td>CP-CC9-R1-01</td>
<td>source_13</td>
<td>20220914_Run1</td>
<td>CRISPR</td>
<td>CP-CC9-R1-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">458</td>
<td>CP-CC9-R1-02</td>
<td>source_13</td>
<td>20220914_Run1</td>
<td>CRISPR</td>
<td>CP-CC9-R1-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">459</td>
<td>CP-CC9-R1-03</td>
<td>source_13</td>
<td>20220914_Run1</td>
<td>CRISPR</td>
<td>CP-CC9-R1-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1591</td>
<td>BR00127145</td>
<td>source_4</td>
<td>2021_08_30_Batch13</td>
<td>ORF</td>
<td>BR00127145__2021-09-22T04_01_46-Measurement1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1592</td>
<td>BR00127146</td>
<td>source_4</td>
<td>2021_08_30_Batch13</td>
<td>ORF</td>
<td>BR00127146__2021-09-22T12_25_07-Measurement1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1593</td>
<td>BR00127147</td>
<td>source_4</td>
<td>2021_08_30_Batch13</td>
<td>ORF</td>
<td>BR00127147__2021-09-18T10_27_12-Measurement1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1594</td>
<td>BR00127148</td>
<td>source_4</td>
<td>2021_08_30_Batch13</td>
<td>ORF</td>
<td>BR00127148__2021-09-21T11_44_23-Measurement1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1595</td>
<td>BR00127149</td>
<td>source_4</td>
<td>2021_08_30_Batch13</td>
<td>ORF</td>
<td>BR00127149__2021-09-18T02_10_04-Measurement1</td>
</tr>
</tbody>
</table>

<p>433 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-90806d63-2489-49a7-997b-7ab9dbde3d27')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-90806d63-2489-49a7-997b-7ab9dbde3d27 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-90806d63-2489-49a7-997b-7ab9dbde3d27');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>
</section></section>
<section>
<section id="create-a-pipeline-for-loading-images-from-the-cellpainting-gallery-storage" class="title-slide slide level1 center">
<h1>Create a pipeline for loading images from the <code>cellpainting-gallery</code> storage</h1>

</section>
<section id="split-the-perturbation-plates-into-training-validation-and-test-sets" class="slide level2 scrollable">
<h2>Split the perturbation plates into Training, Validation, and Test sets</h2>
<p>We’ll separate the plates in each batch into the three sets to have batch-level effects in each of the sets</p>
<ul class="task-list">
<li><label><input type="checkbox">Assign <span class="math inline">\(70\)</span> % of plates for training, <span class="math inline">\(20\)</span> % for validation, and <span class="math inline">\(10\)</span> % for testing</label></li>
</ul>
<div id="519e4428" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a><span class="im">import</span> random</span>
<span id="cb22-2"><a></a><span class="im">import</span> math</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d1e1cf0e" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a>trn_plates <span class="op">=</span> []</span>
<span id="cb23-2"><a></a>val_plates <span class="op">=</span> []</span>
<span id="cb23-3"><a></a>tst_plates <span class="op">=</span> []</span>
<span id="cb23-4"><a></a></span>
<span id="cb23-5"><a></a>trn_proportion <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb23-6"><a></a>val_proportion <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb23-7"><a></a>tst_proportion <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb23-8"><a></a></span>
<span id="cb23-9"><a></a><span class="cf">for</span> batch_name <span class="kw">in</span> pert_plate_maps[<span class="st">"Batch_name"</span>].unique():</span>
<span id="cb23-10"><a></a>    plate_names <span class="op">=</span> pert_plate_maps.query(<span class="ss">f"Batch_name == '</span><span class="sc">{</span>batch_name<span class="sc">}</span><span class="ss">'"</span>)[<span class="st">"Plate_name"</span>].tolist()</span>
<span id="cb23-11"><a></a>    random.shuffle(plate_names)</span>
<span id="cb23-12"><a></a></span>
<span id="cb23-13"><a></a>    tst_plates_count <span class="op">=</span> <span class="bu">int</span>(math.ceil(<span class="bu">len</span>(plate_names) <span class="op">*</span> tst_proportion))</span>
<span id="cb23-14"><a></a>    val_plates_count <span class="op">=</span> <span class="bu">int</span>(math.ceil(<span class="bu">len</span>(plate_names) <span class="op">*</span> val_proportion))</span>
<span id="cb23-15"><a></a></span>
<span id="cb23-16"><a></a>    tst_plates <span class="op">+=</span> plate_names[:tst_plates_count]</span>
<span id="cb23-17"><a></a>    val_plates <span class="op">+=</span> plate_names[tst_plates_count:tst_plates_count <span class="op">+</span> val_plates_count]</span>
<span id="cb23-18"><a></a>    trn_plates <span class="op">+=</span> plate_names[tst_plates_count <span class="op">+</span> val_plates_count:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8c9334e9" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a><span class="bu">print</span>(<span class="st">"Training set size:"</span>, <span class="bu">len</span>(trn_plates))</span>
<span id="cb24-2"><a></a><span class="bu">print</span>(<span class="st">"Validation set size:"</span>, <span class="bu">len</span>(val_plates))</span>
<span id="cb24-3"><a></a><span class="bu">print</span>(<span class="st">"Testing set size:"</span>, <span class="bu">len</span>(tst_plates))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training set size: 283
Validation set size: 96
Testing set size: 54</code></pre>
</div>
</div>
</section>
<section id="create-a-pytorch-dataset-to-load-images-from-s3-storage" class="slide level2 scrollable">
<h2>Create a PyTorch Dataset to load images from S3 storage</h2>
<p>Defining a custom PyTorch dataset allows us to access the image data from S3 storage, even if it is not in a standard format across the distinct sources inside the database. Moreover, it is completely iterative, so no additional storage is used as the images are analyzed <em>on the fly</em>.</p>
<div id="637d0401" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a><span class="co"># @title Definition of a Dataset class capable to pull images from S3 buckets</span></span>
<span id="cb26-2"><a></a><span class="im">import</span> random</span>
<span id="cb26-3"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-4"><a></a><span class="im">import</span> string</span>
<span id="cb26-5"><a></a><span class="im">import</span> s3fs</span>
<span id="cb26-6"><a></a></span>
<span id="cb26-7"><a></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb26-8"><a></a></span>
<span id="cb26-9"><a></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb26-10"><a></a><span class="im">import</span> tifffile</span>
<span id="cb26-11"><a></a></span>
<span id="cb26-12"><a></a><span class="im">from</span> torch.utils.data <span class="im">import</span> IterableDataset, get_worker_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Define a function to load an image from the <code>cellpainting-gallery</code> bucket given a <em>field-well</em> position from a specific <em>plate</em></label></li>
</ul>
<div id="b6ef2f4e" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a><span class="kw">def</span> load_well(plate_metadata, well_row, well_col, field_id, channels, s3):</span>
<span id="cb27-2"><a></a>    <span class="co"># Get the label of the current well</span></span>
<span id="cb27-3"><a></a>    curr_well_image <span class="op">=</span> []</span>
<span id="cb27-4"><a></a></span>
<span id="cb27-5"><a></a>    plate_path <span class="op">=</span> <span class="st">"cellpainting-gallery/cpg0016-jump/"</span> <span class="op">+</span> plate_metadata[<span class="st">"Source_name"</span>] <span class="op">+</span> <span class="st">"/images/"</span> <span class="op">+</span> plate_metadata[<span class="st">"Batch_name"</span>] <span class="op">+</span> <span class="st">"/images/"</span> <span class="op">+</span> plate_metadata[<span class="st">"Plate_path"</span>]</span>
<span id="cb27-6"><a></a></span>
<span id="cb27-7"><a></a>    <span class="cf">for</span> channel_id <span class="kw">in</span> <span class="bu">range</span>(channels):</span>
<span id="cb27-8"><a></a>        <span class="cf">if</span> plate_metadata[<span class="st">"Source_name"</span>] <span class="kw">in</span> [<span class="st">"source_1"</span>, <span class="st">"source_3"</span>, <span class="st">"source_4"</span>, <span class="st">"source_9"</span>, <span class="st">"source_11"</span>, <span class="st">"source_15"</span>]:</span>
<span id="cb27-9"><a></a>            image_suffix <span class="op">=</span> <span class="ss">f"Images/r</span><span class="sc">{</span>well_row <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">c</span><span class="sc">{</span>well_col <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">f</span><span class="sc">{</span>field_id <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">p01-ch</span><span class="sc">{</span>channel_id <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">sk1fk1fl1.tiff"</span></span>
<span id="cb27-10"><a></a></span>
<span id="cb27-11"><a></a>        <span class="cf">else</span>:</span>
<span id="cb27-12"><a></a>            <span class="cf">if</span> plate_metadata[<span class="st">"Source_name"</span>] <span class="kw">in</span> [<span class="st">"source_2"</span>, <span class="st">"source_5"</span>]:</span>
<span id="cb27-13"><a></a>                a_locs <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb27-14"><a></a>            <span class="cf">elif</span> plate_metadata[<span class="st">"Source_name"</span>] <span class="kw">in</span> [<span class="st">"source_6"</span>, <span class="st">"source_10"</span>]:</span>
<span id="cb27-15"><a></a>                a_locs <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>]</span>
<span id="cb27-16"><a></a>            <span class="cf">elif</span> plate_metadata[<span class="st">"Source_name"</span>] <span class="kw">in</span> [<span class="st">"source_7"</span>, <span class="st">"source_13"</span>]:</span>
<span id="cb27-17"><a></a>                a_locs <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb27-18"><a></a></span>
<span id="cb27-19"><a></a>            image_suffix <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>plate_metadata[<span class="st">"Plate_name"</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>string<span class="sc">.</span>ascii_uppercase[well_row]<span class="sc">}{</span>well_col <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">_T0001F</span><span class="sc">{</span>field_id <span class="op">+</span> <span class="dv">1</span><span class="sc">:03d}</span><span class="ss">L01A</span><span class="sc">{</span>a_locs[channel_id]<span class="sc">:02d}</span><span class="ss">Z01C</span><span class="sc">{</span>channel_id <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">.tif"</span></span>
<span id="cb27-20"><a></a></span>
<span id="cb27-21"><a></a>        image_url <span class="op">=</span> <span class="st">"s3://"</span> <span class="op">+</span> plate_path <span class="op">+</span> <span class="st">"/"</span> <span class="op">+</span> image_suffix</span>
<span id="cb27-22"><a></a></span>
<span id="cb27-23"><a></a>        <span class="cf">try</span>:</span>
<span id="cb27-24"><a></a>            <span class="cf">with</span> s3.<span class="bu">open</span>(image_url, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb27-25"><a></a>                curr_image <span class="op">=</span> tifffile.imread(f)</span>
<span id="cb27-26"><a></a></span>
<span id="cb27-27"><a></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb27-28"><a></a>            <span class="bu">print</span>(<span class="st">"Failed retrieving:"</span>, image_url)</span>
<span id="cb27-29"><a></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb27-30"><a></a></span>
<span id="cb27-31"><a></a>        curr_image <span class="op">=</span> curr_image.astype(np.float32)</span>
<span id="cb27-32"><a></a>        curr_image <span class="op">/=</span> <span class="dv">2</span> <span class="op">**</span> <span class="dv">16</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb27-33"><a></a></span>
<span id="cb27-34"><a></a>        curr_well_image.append(curr_image)</span>
<span id="cb27-35"><a></a></span>
<span id="cb27-36"><a></a>    curr_well_image <span class="op">=</span> np.array(curr_well_image)</span>
<span id="cb27-37"><a></a></span>
<span id="cb27-38"><a></a>    <span class="cf">return</span> curr_well_image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-pytorch-dataset-to-load-images-from-s3-storage-1" class="slide level2 scrollable">
<h2>Create a PyTorch Dataset to load images from S3 storage</h2>
<ul class="task-list">
<li><label><input type="checkbox">Define an <code>IterableDataset</code> derived class to load images from S3 storage</label></li>
</ul>
<div id="8f3f3b90" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a><span class="kw">class</span> TiffS3Dataset(IterableDataset):</span>
<span id="cb28-2"><a></a>    <span class="co">"""This dataset could have virtually infinite samples.</span></span>
<span id="cb28-3"><a></a><span class="co">    """</span></span>
<span id="cb28-4"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, plate_maps, wells_metadata, plate_names, well_rows<span class="op">=</span><span class="dv">24</span>, well_cols<span class="op">=</span><span class="dv">16</span>, fields<span class="op">=</span><span class="dv">4</span>, channels<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb28-5"><a></a>        <span class="bu">super</span>(TiffS3Dataset).<span class="fu">__init__</span>()</span>
<span id="cb28-6"><a></a></span>
<span id="cb28-7"><a></a>        <span class="va">self</span>._plate_maps <span class="op">=</span> plate_maps</span>
<span id="cb28-8"><a></a>        <span class="va">self</span>._wells_metadata <span class="op">=</span> wells_metadata</span>
<span id="cb28-9"><a></a></span>
<span id="cb28-10"><a></a>        <span class="va">self</span>._plate_names <span class="op">=</span> plate_names</span>
<span id="cb28-11"><a></a>        <span class="va">self</span>._well_rows <span class="op">=</span> well_rows</span>
<span id="cb28-12"><a></a>        <span class="va">self</span>._well_cols <span class="op">=</span> well_cols</span>
<span id="cb28-13"><a></a>        <span class="va">self</span>._fields <span class="op">=</span> fields</span>
<span id="cb28-14"><a></a>        <span class="va">self</span>._channels <span class="op">=</span> channels</span>
<span id="cb28-15"><a></a></span>
<span id="cb28-16"><a></a>        <span class="va">self</span>._shuffle <span class="op">=</span> shuffle</span>
<span id="cb28-17"><a></a></span>
<span id="cb28-18"><a></a>        <span class="va">self</span>._worker_sel <span class="op">=</span> <span class="bu">slice</span>(<span class="dv">0</span>, <span class="bu">len</span>(plate_names) <span class="op">*</span> <span class="va">self</span>._well_rows <span class="op">*</span> <span class="va">self</span>._well_cols)</span>
<span id="cb28-19"><a></a>        <span class="va">self</span>._worker_id <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-20"><a></a>        <span class="va">self</span>._num_workers <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb28-21"><a></a></span>
<span id="cb28-22"><a></a>        <span class="va">self</span>._s3 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-23"><a></a></span>
<span id="cb28-24"><a></a>    <span class="kw">def</span> <span class="fu">__iter__</span>(<span class="va">self</span>):</span>
<span id="cb28-25"><a></a>        <span class="co"># Select the barcodes that correspond to this worker</span></span>
<span id="cb28-26"><a></a>        <span class="va">self</span>._s3 <span class="op">=</span> s3fs.S3FileSystem(anon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-27"><a></a></span>
<span id="cb28-28"><a></a>        <span class="va">self</span>._plate_names <span class="op">=</span> <span class="va">self</span>._plate_names[<span class="va">self</span>._worker_sel]</span>
<span id="cb28-29"><a></a></span>
<span id="cb28-30"><a></a>        well_row_range <span class="op">=</span> <span class="bu">range</span>(<span class="va">self</span>._well_rows)</span>
<span id="cb28-31"><a></a>        well_col_range <span class="op">=</span> <span class="bu">range</span>(<span class="va">self</span>._well_cols)</span>
<span id="cb28-32"><a></a>        fields_range <span class="op">=</span> <span class="bu">range</span>(<span class="va">self</span>._fields)</span>
<span id="cb28-33"><a></a></span>
<span id="cb28-34"><a></a>        <span class="cf">for</span> plate_name, well_row, well_col, field_id <span class="kw">in</span> product(<span class="va">self</span>._plate_names, well_row_range, well_col_range, fields_range):</span>
<span id="cb28-35"><a></a>            <span class="cf">if</span> <span class="va">self</span>._shuffle:</span>
<span id="cb28-36"><a></a>                plate_name <span class="op">=</span> random.choice(<span class="va">self</span>._plate_names)</span>
<span id="cb28-37"><a></a>                well_row <span class="op">=</span> random.randrange(<span class="va">self</span>._well_rows)</span>
<span id="cb28-38"><a></a>                well_col <span class="op">=</span> random.randrange(<span class="va">self</span>._well_cols)</span>
<span id="cb28-39"><a></a>                field_id <span class="op">=</span> random.randrange(<span class="va">self</span>._fields)</span>
<span id="cb28-40"><a></a></span>
<span id="cb28-41"><a></a>            curr_plate_map <span class="op">=</span> <span class="va">self</span>._plate_maps.query(<span class="ss">f"Plate_name == '</span><span class="sc">{</span>plate_name<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb28-42"><a></a></span>
<span id="cb28-43"><a></a>            curr_plate_metadata <span class="op">=</span> curr_plate_map.to_dict(orient<span class="op">=</span><span class="st">'records'</span>)[<span class="dv">0</span>]</span>
<span id="cb28-44"><a></a></span>
<span id="cb28-45"><a></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">len</span>(curr_plate_metadata):</span>
<span id="cb28-46"><a></a>                <span class="cf">continue</span></span>
<span id="cb28-47"><a></a></span>
<span id="cb28-48"><a></a>            curr_image <span class="op">=</span> load_well(curr_plate_metadata, well_row, well_col, field_id, <span class="va">self</span>._channels, <span class="va">self</span>._s3)</span>
<span id="cb28-49"><a></a></span>
<span id="cb28-50"><a></a>            <span class="cf">if</span> curr_image <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb28-51"><a></a>                <span class="cf">continue</span></span>
<span id="cb28-52"><a></a></span>
<span id="cb28-53"><a></a>            curr_plate_metadata[<span class="st">"Well_position"</span>] <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>string<span class="sc">.</span>ascii_uppercase[well_row]<span class="sc">}{</span>well_col <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">"</span></span>
<span id="cb28-54"><a></a></span>
<span id="cb28-55"><a></a>            curr_image <span class="op">=</span> curr_image[:, :<span class="dv">1080</span>, :<span class="dv">1080</span>]</span>
<span id="cb28-56"><a></a>            _, h, w <span class="op">=</span> curr_image.shape</span>
<span id="cb28-57"><a></a>            pad_h <span class="op">=</span> <span class="dv">1080</span> <span class="op">-</span> h</span>
<span id="cb28-58"><a></a>            pad_w <span class="op">=</span> <span class="dv">1080</span> <span class="op">-</span> w</span>
<span id="cb28-59"><a></a></span>
<span id="cb28-60"><a></a>            <span class="cf">if</span> pad_h <span class="kw">or</span> pad_w:</span>
<span id="cb28-61"><a></a>                curr_image <span class="op">=</span> np.pad(curr_image, ((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, pad_h), (<span class="dv">0</span>, pad_w)))</span>
<span id="cb28-62"><a></a>            </span>
<span id="cb28-63"><a></a>            <span class="cf">if</span> curr_plate_metadata[<span class="st">"Plate_type"</span>] <span class="op">==</span> <span class="st">"DMSO"</span>:</span>
<span id="cb28-64"><a></a>                curr_label <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-65"><a></a></span>
<span id="cb28-66"><a></a>            <span class="cf">else</span>:</span>
<span id="cb28-67"><a></a>                curr_label <span class="op">=</span> <span class="va">self</span>._wells_metadata.query(<span class="ss">f"Plate_type=='</span><span class="sc">{</span>curr_plate_metadata[<span class="st">"Plate_type"</span>]<span class="sc">}</span><span class="ss">' &amp; well_position=='</span><span class="sc">{</span>string<span class="sc">.</span>ascii_uppercase[well_row]<span class="sc">}{</span>well_col <span class="op">+</span> <span class="dv">1</span><span class="sc">:02d}</span><span class="ss">'"</span>)[<span class="st">"Plate_label"</span>]</span>
<span id="cb28-68"><a></a></span>
<span id="cb28-69"><a></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">len</span>(curr_label):</span>
<span id="cb28-70"><a></a>                    <span class="cf">continue</span></span>
<span id="cb28-71"><a></a></span>
<span id="cb28-72"><a></a>                curr_label <span class="op">=</span> curr_label.item()</span>
<span id="cb28-73"><a></a></span>
<span id="cb28-74"><a></a>            <span class="cf">yield</span> curr_image, curr_label, curr_plate_metadata</span>
<span id="cb28-75"><a></a></span>
<span id="cb28-76"><a></a>        <span class="va">self</span>._s3 <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-pytorch-dataset-to-load-images-from-s3-storage-2" class="slide level2 scrollable">
<h2>Create a PyTorch Dataset to load images from S3 storage</h2>
<ul class="task-list">
<li><label><input type="checkbox">Define an initialization function to separate the load when using <em>multi-thread</em> data loading</label></li>
</ul>
<div id="782c35ca" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a><span class="kw">def</span> dataset_worker_init_fn(worker_id):</span>
<span id="cb29-2"><a></a>    <span class="co">"""ZarrDataset multithread workers initialization function.</span></span>
<span id="cb29-3"><a></a><span class="co">    """</span></span>
<span id="cb29-4"><a></a>    worker_info <span class="op">=</span> torch.utils.data.get_worker_info()</span>
<span id="cb29-5"><a></a>    w_sel <span class="op">=</span> <span class="bu">slice</span>(worker_id, <span class="va">None</span>, worker_info.num_workers)</span>
<span id="cb29-6"><a></a></span>
<span id="cb29-7"><a></a>    dataset_obj <span class="op">=</span> worker_info.dataset</span>
<span id="cb29-8"><a></a></span>
<span id="cb29-9"><a></a>    <span class="co"># Reset the random number generators in each worker.</span></span>
<span id="cb29-10"><a></a>    torch_seed <span class="op">=</span> torch.initial_seed()</span>
<span id="cb29-11"><a></a></span>
<span id="cb29-12"><a></a>    dataset_obj._worker_sel <span class="op">=</span> w_sel</span>
<span id="cb29-13"><a></a>    dataset_obj._worker_id <span class="op">=</span> worker_id</span>
<span id="cb29-14"><a></a>    dataset_obj._num_workers <span class="op">=</span> worker_info.num_workers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-the-different-datasets-from-the-plates-lists" class="slide level2 scrollable">
<h2>Create the different datasets from the plates lists</h2>
<ul class="task-list">
<li><label><input type="checkbox">Instantiate a <code>TiffS3Dataset</code> from the plates assigned for training, validation, and testing</label></li>
</ul>
<div id="e10b9000" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a>training_ds <span class="op">=</span> TiffS3Dataset(pert_plate_maps, wells_metadata, trn_plates, <span class="dv">16</span>, <span class="dv">24</span>, <span class="dv">9</span>, <span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-2"><a></a>validation_ds <span class="op">=</span> TiffS3Dataset(pert_plate_maps, wells_metadata, val_plates, <span class="dv">16</span>, <span class="dv">24</span>, <span class="dv">9</span>, <span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-3"><a></a>testing_ds <span class="op">=</span> TiffS3Dataset(pert_plate_maps, wells_metadata, tst_plates, <span class="dv">16</span>, <span class="dv">24</span>, <span class="dv">9</span>, <span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="compute-field-level-morphological-profiles-from-perturbation-plates" class="title-slide slide level1 center">
<h1>Compute field-level morphological profiles from perturbation plates</h1>
<p>We’ll use a pre-trained deep learning model for image recognition to extract morphological features at field-level.</p>
<p>This process is usually applied at cell level; however, we’ll analyze the data at field-level for simplicity.</p>
<p>These morphological profiles will be used subsequently to train a <em>perturbation classifier</em>.</p>
</section>
<section id="import-a-pre-trained-model-from-torchvision" class="slide level2">
<h2>Import a pre-trained model from <code>torchvision</code></h2>
<p>We’ll start with a pre-trained <em>MobileNet</em> model for feature extraction since it is lightweight and fast. This in terms of computation resources required to use this model.</p>
<p>In the literature, more complex models are used, such as Inception V3, DenseNet, or even Vision Transformers. However, these models require GPU acceleration to be efficiently applied.</p>
<ul class="task-list">
<li><label><input type="checkbox">Load a pre-trained <em>MobileNet</em> from the <code>torchvision</code> package</label></li>
</ul>
<div id="9f6eb48d" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a><span class="im">from</span> torchvision.models <span class="im">import</span> mobilenet_v3_small, MobileNet_V3_Small_Weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6b42696f" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a></a>weights <span class="op">=</span> MobileNet_V3_Small_Weights.DEFAULT</span>
<span id="cb32-2"><a></a>model <span class="op">=</span> mobilenet_v3_small(weights<span class="op">=</span>weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modify-the-models-architecture-to-convert-it-into-a-feature-extraction-function" class="slide level2 scrollable">
<h2>Modify the model’s architecture to convert it into a feature extraction <em>function</em></h2>
<ul class="task-list">
<li><label><input type="checkbox">Save the original aggregation layer (Average Pooling) and replace it with an <code>Identity</code> layer</label></li>
</ul>
<div id="982017e9" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a><span class="im">import</span> torch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e649a4db" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a>org_avgpool <span class="op">=</span> model.avgpool</span>
<span id="cb34-2"><a></a>model.avgpool <span class="op">=</span> torch.nn.Identity()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Replace the original <code>classifier</code> layer with an <code>Identity</code> layer</label></li>
</ul>
<div id="340183c7" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a>model.classifier <span class="op">=</span> torch.nn.Identity()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modify-the-models-architecture-to-convert-it-into-a-feature-extraction-function-1" class="slide level2 scrollable">
<h2>Modify the model’s architecture to convert it into a feature extraction <em>function</em></h2>
<ul class="task-list">
<li><label><input type="checkbox">Set the model into <em>evaluation</em> mode. (Optional) Move the model to the GPU if available</label></li>
</ul>
<div id="fcd366d0" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb36-2"><a></a>    model.cuda()</span>
<span id="cb36-3"><a></a></span>
<span id="cb36-4"><a></a>model.<span class="bu">eval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>MobileNetV3(
  (features): Sequential(
    (0): Conv2dNormActivation(
      (0): Conv2d(3, 16, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)
      (1): BatchNorm2d(16, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
      (2): Hardswish()
    )
    (1): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(16, 16, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), groups=16, bias=False)
          (1): BatchNorm2d(16, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): ReLU(inplace=True)
        )
        (1): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(16, 8, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(8, 16, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (2): Conv2dNormActivation(
          (0): Conv2d(16, 16, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(16, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (2): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(16, 72, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(72, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): ReLU(inplace=True)
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(72, 72, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), groups=72, bias=False)
          (1): BatchNorm2d(72, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): ReLU(inplace=True)
        )
        (2): Conv2dNormActivation(
          (0): Conv2d(72, 24, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(24, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (3): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(24, 88, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(88, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): ReLU(inplace=True)
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(88, 88, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), groups=88, bias=False)
          (1): BatchNorm2d(88, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): ReLU(inplace=True)
        )
        (2): Conv2dNormActivation(
          (0): Conv2d(88, 24, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(24, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (4): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(24, 96, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(96, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(96, 96, kernel_size=(5, 5), stride=(2, 2), padding=(2, 2), groups=96, bias=False)
          (1): BatchNorm2d(96, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(96, 24, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(24, 96, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(96, 40, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(40, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (5): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(240, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(240, 240, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=240, bias=False)
          (1): BatchNorm2d(240, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(240, 64, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(64, 240, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(40, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (6): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(240, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(240, 240, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=240, bias=False)
          (1): BatchNorm2d(240, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(240, 64, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(64, 240, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(40, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (7): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(40, 120, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(120, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(120, 120, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=120, bias=False)
          (1): BatchNorm2d(120, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(120, 32, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(32, 120, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(120, 48, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(48, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (8): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(48, 144, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(144, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(144, 144, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=144, bias=False)
          (1): BatchNorm2d(144, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(144, 40, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(40, 144, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(144, 48, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(48, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (9): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(48, 288, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(288, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(288, 288, kernel_size=(5, 5), stride=(2, 2), padding=(2, 2), groups=288, bias=False)
          (1): BatchNorm2d(288, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(288, 72, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(72, 288, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(288, 96, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(96, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (10): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(96, 576, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(576, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(576, 576, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=576, bias=False)
          (1): BatchNorm2d(576, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(576, 144, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(144, 576, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(576, 96, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(96, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (11): InvertedResidual(
      (block): Sequential(
        (0): Conv2dNormActivation(
          (0): Conv2d(96, 576, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(576, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (1): Conv2dNormActivation(
          (0): Conv2d(576, 576, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=576, bias=False)
          (1): BatchNorm2d(576, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
          (2): Hardswish()
        )
        (2): SqueezeExcitation(
          (avgpool): AdaptiveAvgPool2d(output_size=1)
          (fc1): Conv2d(576, 144, kernel_size=(1, 1), stride=(1, 1))
          (fc2): Conv2d(144, 576, kernel_size=(1, 1), stride=(1, 1))
          (activation): ReLU()
          (scale_activation): Hardsigmoid()
        )
        (3): Conv2dNormActivation(
          (0): Conv2d(576, 96, kernel_size=(1, 1), stride=(1, 1), bias=False)
          (1): BatchNorm2d(96, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
        )
      )
    )
    (12): Conv2dNormActivation(
      (0): Conv2d(96, 576, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (1): BatchNorm2d(576, eps=0.001, momentum=0.01, affine=True, track_running_stats=True)
      (2): Hardswish()
    )
  )
  (avgpool): Identity()
  (classifier): Identity()
)</code></pre>
</div>
</div>
</section>
<section id="load-the-pre-processing-transforms-form-the-original-model" class="slide level2 scrollable">
<h2>Load the pre-processing transforms form the original model</h2>
<p>We need to apply the same transforms to the images that we <em>feed</em> to the model to have the expected behavior.</p>
<ul class="task-list">
<li><label><input type="checkbox">Get the original transforms pipeline used when the model was originally trained</label></li>
</ul>
<div id="3d5c4371" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a>model_transforms <span class="op">=</span> weights.transforms()</span>
<span id="cb38-2"><a></a>model_transforms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>ImageClassification(
    crop_size=[224]
    resize_size=[256]
    mean=[0.485, 0.456, 0.406]
    std=[0.229, 0.224, 0.225]
    interpolation=InterpolationMode.BILINEAR
)</code></pre>
</div>
</div>
</section>
<section id="create-a-pytorch-dataloader" class="slide level2">
<h2>Create a PyTorch <code>DataLoader</code></h2>
<p>A <code>DataLoader</code> takes a <code>Dataset</code> (or <code>IterableDataset</code>) and serves <em>mini-batches</em> of samples that can be used for model training or evaluation. It manages the <em>mini-batch</em> collation, and if enabled, the <em>multi-thread</em> loading of data.</p>
<div id="f5fe0df6" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a></a><span class="im">from</span> torch.utils.data.dataloader <span class="im">import</span> DataLoader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1687ea1b" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a>batch_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb41-2"><a></a></span>
<span id="cb41-3"><a></a>training_dl <span class="op">=</span> DataLoader(training_ds, batch_size<span class="op">=</span>batch_size, num_workers<span class="op">=</span><span class="dv">2</span>, worker_init_fn<span class="op">=</span>dataset_worker_init_fn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="execute-the-feature-extraction-with-the-deep-learning-model" class="slide level2 scrollable">
<h2>Execute the feature extraction with the deep learning model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Use the <em>frozen</em> deep learning model to extract morphological features from the field-level images and create a features database</label></li>
</ul>
<div id="fa04567d" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm</span>
<span id="cb42-2"><a></a></span>
<span id="cb42-3"><a></a>features <span class="op">=</span> []</span>
<span id="cb42-4"><a></a>targets <span class="op">=</span> []</span>
<span id="cb42-5"><a></a></span>
<span id="cb42-6"><a></a><span class="cf">for</span> i, (x, y, _) <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(training_dl)):</span>
<span id="cb42-7"><a></a>    b, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb42-8"><a></a>    x_t <span class="op">=</span> model_transforms(torch.tile(x.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, h, w), (<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb42-9"><a></a></span>
<span id="cb42-10"><a></a>    <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb42-11"><a></a>        x_t <span class="op">=</span> x_t.cuda()</span>
<span id="cb42-12"><a></a>    </span>
<span id="cb42-13"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb42-14"><a></a>        x_out <span class="op">=</span> model(x_t)</span>
<span id="cb42-15"><a></a>        x_out <span class="op">=</span> x_out.detach().cpu().reshape(<span class="op">-</span><span class="dv">1</span>, c, <span class="dv">576</span>, <span class="dv">7</span>, <span class="dv">7</span>).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb42-16"><a></a>        x_out <span class="op">=</span> org_avgpool(x_out).detach().reshape(b, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb42-17"><a></a></span>
<span id="cb42-18"><a></a>    features.append(x_out)</span>
<span id="cb42-19"><a></a>    targets.append(y)</span>
<span id="cb42-20"><a></a></span>
<span id="cb42-21"><a></a>    <span class="co"># This is for illustration purposes.</span></span>
<span id="cb42-22"><a></a>    <span class="co"># We'll load the pre-extracted features from Cloud Storage, so no need to generate it here.</span></span>
<span id="cb42-23"><a></a>    <span class="cf">break</span></span>
<span id="cb42-24"><a></a></span>
<span id="cb42-25"><a></a>features <span class="op">=</span> torch.cat(features, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb42-26"><a></a>targets <span class="op">=</span> torch.cat(targets, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb42-27"><a></a></span>
<span id="cb42-28"><a></a>features.shape, targets.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d9b02cdbd72747a6a2306f40f0fb0ef3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>(torch.Size([10, 576]), torch.Size([10]))</code></pre>
</div>
</div>
</section>
<section id="execute-the-feature-extraction-with-the-deep-learning-model-1" class="slide level2 scrollable">
<h2>Execute the feature extraction with the deep learning model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Perform the same operation for the <strong>validation</strong> set</label></li>
</ul>
<div id="75525e1d" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a></a>val_features <span class="op">=</span> []</span>
<span id="cb44-2"><a></a>val_targets <span class="op">=</span> []</span>
<span id="cb44-3"><a></a></span>
<span id="cb44-4"><a></a>validation_dl <span class="op">=</span> DataLoader(validation_ds, batch_size<span class="op">=</span>batch_size, num_workers<span class="op">=</span><span class="dv">2</span>, worker_init_fn<span class="op">=</span>dataset_worker_init_fn)</span>
<span id="cb44-5"><a></a></span>
<span id="cb44-6"><a></a><span class="cf">for</span> i, (x, y, _) <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(validation_dl)):</span>
<span id="cb44-7"><a></a>    b, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb44-8"><a></a>    x_t <span class="op">=</span> model_transforms(torch.tile(x.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, h, w), (<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb44-9"><a></a></span>
<span id="cb44-10"><a></a>    <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb44-11"><a></a>        x_t <span class="op">=</span> x_t.cuda()</span>
<span id="cb44-12"><a></a>    </span>
<span id="cb44-13"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb44-14"><a></a>        x_out <span class="op">=</span> model(x_t)</span>
<span id="cb44-15"><a></a>        x_out <span class="op">=</span> x_out.detach().reshape(<span class="op">-</span><span class="dv">1</span>, c, <span class="dv">576</span>, <span class="dv">7</span>, <span class="dv">7</span>).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-16"><a></a>        x_out <span class="op">=</span> org_avgpool(x_out).detach().reshape(b, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb44-17"><a></a></span>
<span id="cb44-18"><a></a>    val_features.append(x_out)</span>
<span id="cb44-19"><a></a>    val_targets.append(y)</span>
<span id="cb44-20"><a></a></span>
<span id="cb44-21"><a></a>    <span class="cf">break</span></span>
<span id="cb44-22"><a></a></span>
<span id="cb44-23"><a></a>val_features <span class="op">=</span> torch.cat(val_features, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-24"><a></a>val_targets <span class="op">=</span> torch.cat(val_targets, dim<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"21a3d3cbae5f48f8975ac04eded252a0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
<section id="execute-the-feature-extraction-with-the-deep-learning-model-2" class="slide level2 scrollable">
<h2>Execute the feature extraction with the deep learning model</h2>
<ul class="task-list">
<li><label><input type="checkbox">And again for the testing set</label></li>
</ul>
<div id="06af51a2" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a>tst_features <span class="op">=</span> []</span>
<span id="cb45-2"><a></a>tst_targets <span class="op">=</span> []</span>
<span id="cb45-3"><a></a></span>
<span id="cb45-4"><a></a>testing_dl <span class="op">=</span> DataLoader(testing_ds, batch_size<span class="op">=</span>batch_size, num_workers<span class="op">=</span><span class="dv">2</span>, worker_init_fn<span class="op">=</span>dataset_worker_init_fn)</span>
<span id="cb45-5"><a></a></span>
<span id="cb45-6"><a></a><span class="cf">for</span> i, (x, y, _) <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(testing_dl)):</span>
<span id="cb45-7"><a></a>    b, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb45-8"><a></a>    x_t <span class="op">=</span> model_transforms(torch.tile(x.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, h, w), (<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb45-9"><a></a></span>
<span id="cb45-10"><a></a>    <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb45-11"><a></a>        x_t <span class="op">=</span> x_t.cuda()</span>
<span id="cb45-12"><a></a>    </span>
<span id="cb45-13"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb45-14"><a></a>        x_out <span class="op">=</span> model(x_t)</span>
<span id="cb45-15"><a></a>        x_out <span class="op">=</span> x_out.detach().reshape(<span class="op">-</span><span class="dv">1</span>, c, <span class="dv">576</span>, <span class="dv">7</span>, <span class="dv">7</span>).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-16"><a></a>        x_out <span class="op">=</span> org_avgpool(x_out).detach().reshape(b, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb45-17"><a></a></span>
<span id="cb45-18"><a></a>    tst_features.append(x_out)</span>
<span id="cb45-19"><a></a>    tst_targets.append(y)</span>
<span id="cb45-20"><a></a></span>
<span id="cb45-21"><a></a>    <span class="cf">break</span></span>
<span id="cb45-22"><a></a></span>
<span id="cb45-23"><a></a>tst_features <span class="op">=</span> torch.cat(tst_features, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-24"><a></a>tst_targets <span class="op">=</span> torch.cat(tst_targets, dim<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"158f7062a8f749c39f8533ba5ca18bc9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section></section>
<section>
<section id="train-a-perturbation-classifier-model" class="title-slide slide level1 center">
<h1>Train a perturbation classifier model</h1>
<p>We’ll take the pre-extracted features and train a perturbation classifier.</p>
<p>This approach will use a Multilayer Perceptron (<strong>MLP</strong>) model to classify the field-level profiles into three categories: <em>NONE/DMSO</em> = 0, <em>CRISPR</em> = 1, and <em>ORF</em> = 2.</p>
<p>The model will be fitted using <em>Adam</em> optimizer, which objective is to reduce the <em>Cross Entropy</em> loss between the predicted and the ground-truth category of each field.</p>
</section>
<section id="load-the-pre-extracted-features-to-train-the-classifier" class="slide level2 scrollable">
<h2>Load the pre-extracted features to train the classifier</h2>
<ul class="task-list">
<li><label><input type="checkbox">Define an <code>IterableDataset</code> to load the features from the <code>trn_feature_XXX.pt</code> files</label></li>
</ul>
<div id="35b15254" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a><span class="kw">class</span> GCPStorageDataset(IterableDataset):</span>
<span id="cb46-2"><a></a>    <span class="co">"""This dataset loads the features from Cloud Storage</span></span>
<span id="cb46-3"><a></a><span class="co">    """</span></span>
<span id="cb46-4"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, features_url, reducer<span class="op">=</span><span class="va">None</span>, shuffle<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb46-5"><a></a>        <span class="bu">super</span>(GCPStorageDataset).<span class="fu">__init__</span>()</span>
<span id="cb46-6"><a></a></span>
<span id="cb46-7"><a></a>        <span class="va">self</span>._features_url <span class="op">=</span> features_url</span>
<span id="cb46-8"><a></a>        <span class="va">self</span>._features_dict <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-9"><a></a>        <span class="va">self</span>._reducer <span class="op">=</span> reducer</span>
<span id="cb46-10"><a></a></span>
<span id="cb46-11"><a></a>        <span class="va">self</span>._shuffle <span class="op">=</span> shuffle</span>
<span id="cb46-12"><a></a></span>
<span id="cb46-13"><a></a>        <span class="va">self</span>._worker_sel <span class="op">=</span> <span class="bu">slice</span>(<span class="dv">0</span>, <span class="bu">len</span>(<span class="va">self</span>._features_url))</span>
<span id="cb46-14"><a></a>        <span class="va">self</span>._worker_id <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb46-15"><a></a>        <span class="va">self</span>._num_workers <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-16"><a></a></span>
<span id="cb46-17"><a></a>    <span class="kw">def</span> <span class="fu">__iter__</span>(<span class="va">self</span>):</span>
<span id="cb46-18"><a></a>        <span class="co"># Select the barcodes that correspond to this worker</span></span>
<span id="cb46-19"><a></a>        <span class="va">self</span>._features_url <span class="op">=</span> <span class="va">self</span>._features_url[<span class="va">self</span>._worker_sel]</span>
<span id="cb46-20"><a></a></span>
<span id="cb46-21"><a></a>        <span class="cf">if</span> <span class="va">self</span>._shuffle:</span>
<span id="cb46-22"><a></a>            random.shuffle(<span class="va">self</span>._features_url)</span>
<span id="cb46-23"><a></a></span>
<span id="cb46-24"><a></a>        <span class="cf">for</span> url <span class="kw">in</span> <span class="va">self</span>._features_url:</span>
<span id="cb46-25"><a></a>            features_dict <span class="op">=</span> torch.load(url)</span>
<span id="cb46-26"><a></a>            </span>
<span id="cb46-27"><a></a>            <span class="cf">if</span> <span class="va">self</span>._reducer <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb46-28"><a></a>                embeddings <span class="op">=</span> reducer.transform(features_dict[<span class="st">"features"</span>])</span>
<span id="cb46-29"><a></a></span>
<span id="cb46-30"><a></a>            curr_n_samples <span class="op">=</span> <span class="bu">len</span>(features_dict[<span class="st">"features"</span>])</span>
<span id="cb46-31"><a></a></span>
<span id="cb46-32"><a></a>            <span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(curr_n_samples):</span>
<span id="cb46-33"><a></a>                <span class="cf">if</span> <span class="va">self</span>._shuffle:</span>
<span id="cb46-34"><a></a>                    index <span class="op">=</span> random.randrange(curr_n_samples)</span>
<span id="cb46-35"><a></a></span>
<span id="cb46-36"><a></a>                feats <span class="op">=</span> features_dict[<span class="st">"features"</span>][index]</span>
<span id="cb46-37"><a></a>                target <span class="op">=</span> features_dict[<span class="st">"targets"</span>][index]</span>
<span id="cb46-38"><a></a></span>
<span id="cb46-39"><a></a>                <span class="cf">if</span> <span class="va">self</span>._reducer <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb46-40"><a></a>                    reduced_feats <span class="op">=</span> embeddings[index]</span>
<span id="cb46-41"><a></a>                <span class="cf">else</span>:</span>
<span id="cb46-42"><a></a>                    reduced_feats <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-43"><a></a></span>
<span id="cb46-44"><a></a>                <span class="cf">yield</span> feats, target, reduced_feats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-the-distribution-of-the-feature-space" class="slide level2">
<h2>Inspect the distribution of the feature space</h2>
<ul class="task-list">
<li><label><input type="checkbox">Fit a UMap to the training set of features to reduce the <span class="math inline">\(576\)</span> features into only <span class="math inline">\(2\)</span> dimensions for visualization</label></li>
</ul>
<div id="332a3d06" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a><span class="im">import</span> umap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cc16cc5d" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a></a>reducer <span class="op">=</span> umap.UMAP()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-the-distribution-of-the-feature-space-1" class="slide level2">
<h2>Inspect the distribution of the feature space</h2>
<ul class="task-list">
<li><label><input type="checkbox">Load the training features and fit the UMap reducer</label></li>
</ul>
<div id="76568337" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a>trn_features_ds <span class="op">=</span> GCPStorageDataset([<span class="st">"trn_features_002.pt"</span>], shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-2"><a></a></span>
<span id="cb49-3"><a></a>trn_features, trn_targets, _ <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>trn_features_ds))</span>
<span id="cb49-4"><a></a></span>
<span id="cb49-5"><a></a>trn_targets <span class="op">=</span> torch.tensor(trn_targets)</span>
<span id="cb49-6"><a></a></span>
<span id="cb49-7"><a></a>reducer.fit(trn_features)</span>
<span id="cb49-8"><a></a></span>
<span id="cb49-9"><a></a>trn_embeddings <span class="op">=</span> reducer.transform(trn_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-828861056.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> trn_features_ds <span class="ansi-blue-fg">=</span> GCPStorageDataset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"trn_features_002.pt"</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> shuffle<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      2</span> 
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>trn_features<span class="ansi-blue-fg">,</span> trn_targets<span class="ansi-blue-fg">,</span> _ <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>trn_features_ds<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      4</span> 
<span class="ansi-green-fg ansi-bold">      5</span> trn_targets <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>tensor<span class="ansi-blue-fg">(</span>trn_targets<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipython-input-2874583140.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">     23</span> 
<span class="ansi-green-fg ansi-bold">     24</span>         <span class="ansi-green-fg">for</span> url <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_features_url<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">             </span>features_dict <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     26</span> 
<span class="ansi-green-fg ansi-bold">     27</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_reducer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(f, map_location, pickle_module, weights_only, mmap, **pickle_load_args)</span>
<span class="ansi-green-fg ansi-bold">   1482</span>         pickle_load_args<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"encoding"</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"utf-8"</span>
<span class="ansi-green-fg ansi-bold">   1483</span> 
<span class="ansi-green-fg">-&gt; 1484</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> _open_file_like<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">"rb"</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> opened_file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1485</span>         <span class="ansi-green-fg">if</span> _is_zipfile<span class="ansi-blue-fg">(</span>opened_file<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1486</span>             <span class="ansi-red-fg"># The zipfile reader is going to advance the current file position.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">_open_file_like</span><span class="ansi-blue-fg">(name_or_buffer, mode)</span>
<span class="ansi-green-fg ansi-bold">    757</span> <span class="ansi-green-fg">def</span> _open_file_like<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">:</span> FileLike<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> _opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    758</span>     <span class="ansi-green-fg">if</span> _is_path<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 759</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _open_file<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    760</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    761</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">"w"</span> <span class="ansi-green-fg">in</span> mode<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, name, mode)</span>
<span class="ansi-green-fg ansi-bold">    738</span> <span class="ansi-green-fg">class</span> _open_file<span class="ansi-blue-fg">(</span>_opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    739</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">:</span> Union<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">,</span> os<span class="ansi-blue-fg">.</span>PathLike<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 740</span><span class="ansi-red-fg">         </span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    741</span> 
<span class="ansi-green-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> __exit__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'trn_features_002.pt'</pre>
</div>
</div>
</div>
</section>
<section id="inspect-the-distribution-of-the-feature-space-2" class="slide level2 scrollable">
<h2>Inspect the distribution of the feature space</h2>
<ul class="task-list">
<li><label><input type="checkbox">Visualize the reduced feature space in two dimensions</label></li>
</ul>
<div id="72aa3373" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb50-2"><a></a></span>
<span id="cb50-3"><a></a>class_names <span class="op">=</span> [<span class="st">"NONE/DMSO"</span>, <span class="st">"CRISPR"</span>, <span class="st">"ORF"</span>, <span class="st">"COMPOUND"</span>]</span>
<span id="cb50-4"><a></a>class_markers <span class="op">=</span> [<span class="st">"*"</span>, <span class="st">"s"</span>, <span class="st">"o"</span>, <span class="st">"^"</span>]</span>
<span id="cb50-5"><a></a>class_colors <span class="op">=</span> [<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>]</span>
<span id="cb50-6"><a></a>class_facecolors <span class="op">=</span> [<span class="st">"black"</span>, <span class="st">"none"</span>, <span class="st">"none"</span>, <span class="st">"none"</span>]</span>
<span id="cb50-7"><a></a></span>
<span id="cb50-8"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names):</span>
<span id="cb50-9"><a></a>    plt.scatter(trn_embeddings[trn_targets <span class="op">==</span> class_idx, <span class="dv">0</span>][::<span class="dv">10</span>], trn_embeddings[trn_targets <span class="op">==</span> class_idx, <span class="dv">1</span>][::<span class="dv">10</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb50-10"><a></a></span>
<span id="cb50-11"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-614479785.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      7</span> 
<span class="ansi-green-fg ansi-bold">      8</span> <span class="ansi-green-fg">for</span> class_idx<span class="ansi-blue-fg">,</span> class_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>class_names<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>trn_embeddings<span class="ansi-blue-fg">[</span>trn_targets <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> trn_embeddings<span class="ansi-blue-fg">[</span>trn_targets <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     10</span> 
<span class="ansi-green-fg ansi-bold">     11</span> plt<span class="ansi-blue-fg">.</span>legend<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name 'trn_embeddings' is not defined</pre>
</div>
</div>
</div>
</section>
<section id="inspect-the-distribution-of-the-feature-space-3" class="slide level2 scrollable">
<h2>Inspect the distribution of the feature space</h2>
<ul class="task-list">
<li><label><input type="checkbox">Confirm that the validation set is mapped to a similar space as the training set</label></li>
</ul>
<div id="59d5c9c4" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a>val_features_ds <span class="op">=</span> GCPStorageDataset([<span class="st">"val_features.pt"</span>], shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-2"><a></a></span>
<span id="cb51-3"><a></a>val_features, val_targets, _ <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>val_features_ds))</span>
<span id="cb51-4"><a></a></span>
<span id="cb51-5"><a></a>val_targets <span class="op">=</span> torch.tensor(val_targets)</span>
<span id="cb51-6"><a></a></span>
<span id="cb51-7"><a></a>val_embedding <span class="op">=</span> reducer.transform(val_features)</span>
<span id="cb51-8"><a></a></span>
<span id="cb51-9"><a></a>val_embedding.shape</span>
<span id="cb51-10"><a></a></span>
<span id="cb51-11"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names):</span>
<span id="cb51-12"><a></a>    plt.scatter(val_embedding[val_targets <span class="op">==</span> class_idx, <span class="dv">0</span>][::<span class="dv">10</span>], val_embedding[val_targets <span class="op">==</span> class_idx, <span class="dv">1</span>][::<span class="dv">10</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb51-13"><a></a></span>
<span id="cb51-14"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-2608381846.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> val_features_ds <span class="ansi-blue-fg">=</span> GCPStorageDataset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"val_features.pt"</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> shuffle<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      2</span> 
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>val_features<span class="ansi-blue-fg">,</span> val_targets<span class="ansi-blue-fg">,</span> _ <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>val_features_ds<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      4</span> 
<span class="ansi-green-fg ansi-bold">      5</span> val_targets <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>tensor<span class="ansi-blue-fg">(</span>val_targets<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipython-input-2874583140.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">     23</span> 
<span class="ansi-green-fg ansi-bold">     24</span>         <span class="ansi-green-fg">for</span> url <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_features_url<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">             </span>features_dict <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     26</span> 
<span class="ansi-green-fg ansi-bold">     27</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_reducer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(f, map_location, pickle_module, weights_only, mmap, **pickle_load_args)</span>
<span class="ansi-green-fg ansi-bold">   1482</span>         pickle_load_args<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"encoding"</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"utf-8"</span>
<span class="ansi-green-fg ansi-bold">   1483</span> 
<span class="ansi-green-fg">-&gt; 1484</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> _open_file_like<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">"rb"</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> opened_file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1485</span>         <span class="ansi-green-fg">if</span> _is_zipfile<span class="ansi-blue-fg">(</span>opened_file<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1486</span>             <span class="ansi-red-fg"># The zipfile reader is going to advance the current file position.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">_open_file_like</span><span class="ansi-blue-fg">(name_or_buffer, mode)</span>
<span class="ansi-green-fg ansi-bold">    757</span> <span class="ansi-green-fg">def</span> _open_file_like<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">:</span> FileLike<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> _opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    758</span>     <span class="ansi-green-fg">if</span> _is_path<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 759</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _open_file<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    760</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    761</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">"w"</span> <span class="ansi-green-fg">in</span> mode<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, name, mode)</span>
<span class="ansi-green-fg ansi-bold">    738</span> <span class="ansi-green-fg">class</span> _open_file<span class="ansi-blue-fg">(</span>_opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    739</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">:</span> Union<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">,</span> os<span class="ansi-blue-fg">.</span>PathLike<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 740</span><span class="ansi-red-fg">         </span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    741</span> 
<span class="ansi-green-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> __exit__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'val_features.pt'</pre>
</div>
</div>
</div>
</section>
<section id="create-a-classifier-with-a-multilayer-perceptron-mlp-architecture" class="slide level2 scrollable">
<h2>Create a classifier with a Multilayer Perceptron (<strong>MLP</strong>) architecture</h2>
<p>The <em>MobileNet</em> model extracts <span class="math inline">\(576\)</span> features per image, these will be the input features for the <em>MLP</em> classifer.</p>
<ul class="task-list">
<li><label><input type="checkbox">Define a Multilayer Perceptron <em>MLP</em> classifier that takes the pre-extracted features and predicts the perturbation applied to that sample</label></li>
</ul>
<div id="d9a17412" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a></a><span class="kw">class</span> PerturbationClassifier(torch.nn.Module):</span>
<span id="cb52-2"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, num_features, num_classes):</span>
<span id="cb52-3"><a></a>        <span class="bu">super</span>(PerturbationClassifier, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb52-4"><a></a></span>
<span id="cb52-5"><a></a>        <span class="va">self</span>._reducer <span class="op">=</span> torch.nn.Sequential(</span>
<span id="cb52-6"><a></a>            torch.nn.BatchNorm1d(num_features<span class="op">=</span>num_features),</span>
<span id="cb52-7"><a></a>            torch.nn.Linear(in_features<span class="op">=</span>num_features, out_features<span class="op">=</span><span class="dv">2</span>, bias<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb52-8"><a></a>        )</span>
<span id="cb52-9"><a></a></span>
<span id="cb52-10"><a></a>        <span class="va">self</span>._classifier <span class="op">=</span> torch.nn.Sequential(</span>
<span id="cb52-11"><a></a>            torch.nn.Dropout(<span class="fl">0.1</span>),</span>
<span id="cb52-12"><a></a>            torch.nn.ReLU(),</span>
<span id="cb52-13"><a></a>            torch.nn.Linear(in_features<span class="op">=</span><span class="dv">2</span>, out_features<span class="op">=</span>num_classes, bias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-14"><a></a>        )</span>
<span id="cb52-15"><a></a></span>
<span id="cb52-16"><a></a>    <span class="kw">def</span> forward(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb52-17"><a></a>        fx <span class="op">=</span> <span class="va">self</span>._reducer(<span class="bu">input</span>)</span>
<span id="cb52-18"><a></a>        </span>
<span id="cb52-19"><a></a>        y_pred <span class="op">=</span> <span class="va">self</span>._classifier(fx)</span>
<span id="cb52-20"><a></a></span>
<span id="cb52-21"><a></a>        <span class="cf">return</span> y_pred, fx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-classifier-with-a-multilayer-perceptron-mlp-architecture-1" class="slide level2 scrollable">
<h2>Create a classifier with a Multilayer Perceptron (<strong>MLP</strong>) architecture</h2>
<ul class="task-list">
<li><label><input type="checkbox">Instantiate the classifier for the set of <span class="math inline">\(576\)</span> features and <span class="math inline">\(3\)</span> classes</label></li>
</ul>
<div id="13e3d2bb" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a></a>classifier <span class="op">=</span> PerturbationClassifier(<span class="dv">576</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">(Optional) If a GPU is available, move the classifier model to it</label></li>
</ul>
<div id="9e43e1fa" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb54-2"><a></a>    classifier.cuda()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-classifier-with-a-multilayer-perceptron-mlp-architecture-2" class="slide level2 scrollable">
<h2>Create a classifier with a Multilayer Perceptron (<strong>MLP</strong>) architecture</h2>
<ul class="task-list">
<li><label><input type="checkbox">Define the optimizer algorithm</label></li>
</ul>
<div id="c5fe70a0" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a></a>optimizer <span class="op">=</span> torch.optim.Adam([</span>
<span id="cb55-2"><a></a>    {<span class="st">'params'</span>: classifier._reducer.parameters(), <span class="st">'lr'</span>: <span class="fl">1e-5</span>, <span class="st">'weight_decay'</span>: <span class="fl">0.001</span>},</span>
<span id="cb55-3"><a></a>    {<span class="st">'params'</span>: classifier._classifier.parameters(), <span class="st">'lr'</span>: <span class="fl">1e-4</span>}</span>
<span id="cb55-4"><a></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Define the loss function used to assess the classification performance of the model</label></li>
</ul>
<div id="fef64f1a" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a></a>classifier_loss_fn <span class="op">=</span> torch.nn.CrossEntropyLoss()</span>
<span id="cb56-2"><a></a>reducer_loss_fn <span class="op">=</span> torch.nn.MSELoss()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-the-mlp-model" class="slide level2 scrollable">
<h2>Train the <em>MLP</em> model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Instantiate the datasets that will load the features from Cloud Storage</label></li>
</ul>
<div id="b478dc32" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a></a>trn_feat_ds <span class="op">=</span> GCPStorageDataset([<span class="ss">f"trn_features_</span><span class="sc">{</span>i<span class="sc">:03d}</span><span class="ss">.pt"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)], reducer<span class="op">=</span>reducer, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-2"><a></a>val_feat_ds <span class="op">=</span> GCPStorageDataset([<span class="st">"val_features.pt"</span>], reducer<span class="op">=</span>reducer, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb57-3"><a></a>tst_feat_ds <span class="op">=</span> GCPStorageDataset([<span class="st">"tst_features.pt"</span>], reducer<span class="op">=</span>reducer, shuffle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Create one <code>DataLoader</code> for the training set and one for the validation set of pre-extracted features</label></li>
</ul>
<div id="3cae185c" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a></a>trn_feat_dl <span class="op">=</span> DataLoader(trn_feat_ds, batch_size<span class="op">=</span><span class="dv">100</span>, num_workers<span class="op">=</span><span class="dv">2</span>, worker_init_fn<span class="op">=</span>dataset_worker_init_fn)</span>
<span id="cb58-2"><a></a>val_feat_dl <span class="op">=</span> DataLoader(val_feat_ds, batch_size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb58-3"><a></a>tst_feat_dl <span class="op">=</span> DataLoader(tst_feat_ds, batch_size<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-the-mlp-model-1" class="slide level2 scrollable">
<h2>Train the <em>MLP</em> model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Implement the training loop</label></li>
</ul>
<div id="37f1d6cb" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a></a><span class="im">from</span> torchmetrics.classification <span class="im">import</span> Accuracy</span>
<span id="cb59-2"><a></a></span>
<span id="cb59-3"><a></a>n_dmso <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-4"><a></a>n_crispr <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-5"><a></a>n_orf <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-6"><a></a></span>
<span id="cb59-7"><a></a><span class="co"># Training loop</span></span>
<span id="cb59-8"><a></a>classifier.train()</span>
<span id="cb59-9"><a></a></span>
<span id="cb59-10"><a></a>cls_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-11"><a></a>red_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-12"><a></a></span>
<span id="cb59-13"><a></a>trn_acc_metric <span class="op">=</span> Accuracy(task<span class="op">=</span><span class="st">"multiclass"</span>, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb59-14"><a></a></span>
<span id="cb59-15"><a></a><span class="cf">for</span> x, y, fx <span class="kw">in</span> tqdm(trn_feat_dl, total<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb59-16"><a></a>    optimizer.zero_grad()</span>
<span id="cb59-17"><a></a></span>
<span id="cb59-18"><a></a>    <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb59-19"><a></a>        x <span class="op">=</span> x.cuda()</span>
<span id="cb59-20"><a></a></span>
<span id="cb59-21"><a></a>    y_pred, fx_pred <span class="op">=</span> classifier(x)</span>
<span id="cb59-22"><a></a></span>
<span id="cb59-23"><a></a>    cls_loss <span class="op">=</span> classifier_loss_fn(y_pred.cpu(), y)</span>
<span id="cb59-24"><a></a>    red_loss <span class="op">=</span> reducer_loss_fn(fx_pred.cpu(), fx)</span>
<span id="cb59-25"><a></a></span>
<span id="cb59-26"><a></a>    cls_loss.backward(retain_graph<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-27"><a></a>    red_loss.backward()</span>
<span id="cb59-28"><a></a></span>
<span id="cb59-29"><a></a>    optimizer.step()</span>
<span id="cb59-30"><a></a></span>
<span id="cb59-31"><a></a>    cls_loss_epoch <span class="op">+=</span> cls_loss.item()</span>
<span id="cb59-32"><a></a>    red_loss_epoch <span class="op">+=</span> red_loss.item()</span>
<span id="cb59-33"><a></a></span>
<span id="cb59-34"><a></a>    trn_acc_metric(y_pred.cpu().softmax(dim<span class="op">=</span><span class="dv">1</span>), y)</span>
<span id="cb59-35"><a></a></span>
<span id="cb59-36"><a></a>    n_dmso <span class="op">+=</span> <span class="bu">sum</span>(y <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb59-37"><a></a>    n_crispr <span class="op">+=</span> <span class="bu">sum</span>(y <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb59-38"><a></a>    n_orf <span class="op">+=</span> <span class="bu">sum</span>(y <span class="op">==</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6d3e635ee37d4c1ebde4339c905bf729","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-4236613521.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">     13</span> trn_acc_metric <span class="ansi-blue-fg">=</span> Accuracy<span class="ansi-blue-fg">(</span>task<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">"multiclass"</span><span class="ansi-blue-fg">,</span> num_classes<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     14</span> 
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> fx <span class="ansi-green-fg">in</span> tqdm<span class="ansi-blue-fg">(</span>trn_feat_dl<span class="ansi-blue-fg">,</span> total<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     16</span>     optimizer<span class="ansi-blue-fg">.</span>zero_grad<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     17</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/tqdm/notebook.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    248</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    249</span>             it <span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__iter__<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 250</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">for</span> obj <span class="ansi-green-fg">in</span> it<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    251</span>                 <span class="ansi-red-fg"># return super(tqdm...) will not catch exception</span>
<span class="ansi-green-fg ansi-bold">    252</span>                 <span class="ansi-green-fg">yield</span> obj

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/tqdm/std.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">   1179</span> 
<span class="ansi-green-fg ansi-bold">   1180</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1181</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">for</span> obj <span class="ansi-green-fg">in</span> iterable<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1182</span>                 <span class="ansi-green-fg">yield</span> obj
<span class="ansi-green-fg ansi-bold">   1183</span>                 <span class="ansi-red-fg"># Update and possibly print the progressbar.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    732</span>                 <span class="ansi-red-fg"># TODO(https://github.com/pytorch/pytorch/issues/76750)</span>
<span class="ansi-green-fg ansi-bold">    733</span>                 self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[call-arg]</span>
<span class="ansi-green-fg">--&gt; 734</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    735</span>             self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">    736</span>             if (

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">   1514</span>                 worker_id <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_task_info<span class="ansi-blue-fg">.</span>pop<span class="ansi-blue-fg">(</span>idx<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg ansi-bold">   1515</span>                 self<span class="ansi-blue-fg">.</span>_rcvd_idx <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">-&gt; 1516</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_process_data<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> worker_id<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1517</span> 
<span class="ansi-green-fg ansi-bold">   1518</span>     <span class="ansi-green-fg">def</span> _try_put_index<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_process_data</span><span class="ansi-blue-fg">(self, data, worker_idx)</span>
<span class="ansi-green-fg ansi-bold">   1549</span>         self<span class="ansi-blue-fg">.</span>_try_put_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1550</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> ExceptionWrapper<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1551</span><span class="ansi-red-fg">             </span>data<span class="ansi-blue-fg">.</span>reraise<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1552</span>         <span class="ansi-green-fg">return</span> data
<span class="ansi-green-fg ansi-bold">   1553</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/_utils.py</span> in <span class="ansi-cyan-fg">reraise</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    767</span>             <span class="ansi-red-fg"># be constructed, don't try to instantiate since we don't know how to</span>
<span class="ansi-green-fg ansi-bold">    768</span>             <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span>msg<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 769</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> exception
<span class="ansi-green-fg ansi-bold">    770</span> 
<span class="ansi-green-fg ansi-bold">    771</span> 

<span class="ansi-red-fg">FileNotFoundError</span>: Caught FileNotFoundError in DataLoader worker process 0.
Original Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/fetch.py", line 33, in fetch
    data.append(next(self.dataset_iter))
                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ipython-input-2874583140.py", line 25, in __iter__
    features_dict = torch.load(url)
                    ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 1484, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 759, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 740, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'trn_features_006.pt'
</pre>
</div>
</div>
</div>
</section>
<section id="train-the-mlp-model-2" class="slide level2 scrollable">
<h2>Train the <em>MLP</em> model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Compute the proportion of samples per category in the training set</label></li>
</ul>
<div id="5d08ee63" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a></a>n_total <span class="op">=</span> n_dmso <span class="op">+</span> n_crispr <span class="op">+</span> n_orf</span>
<span id="cb60-2"><a></a>n_dmso <span class="op">/</span> n_total, n_crispr <span class="op">/</span> n_total, n_orf <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-351853166.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> n_total <span class="ansi-blue-fg">=</span> n_dmso <span class="ansi-blue-fg">+</span> n_crispr <span class="ansi-blue-fg">+</span> n_orf
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>n_dmso <span class="ansi-blue-fg">/</span> n_total<span class="ansi-blue-fg">,</span> n_crispr <span class="ansi-blue-fg">/</span> n_total<span class="ansi-blue-fg">,</span> n_orf <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Check the average loss metric of the model on the training set</label></li>
</ul>
<div id="91b6bc37" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a></a>cls_loss_epoch <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-2159926283.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>cls_loss_epoch <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<div id="4525fcaf" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a></a>red_loss_epoch <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-1461694865.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>red_loss_epoch <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Compute the average accuracy of the model on the training set</label></li>
</ul>
<div id="22e49043" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a></a>trn_acc_metric.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>tensor(0.)</code></pre>
</div>
</div>
</section>
<section id="train-the-mlp-model-3" class="slide level2 scrollable">
<h2>Train the <em>MLP</em> model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Implement the validation loop</label></li>
</ul>
<div id="a6320e71" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a></a>n_dmso <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-2"><a></a>n_crispr <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-3"><a></a>n_orf <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-4"><a></a></span>
<span id="cb65-5"><a></a>cls_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-6"><a></a>red_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-7"><a></a></span>
<span id="cb65-8"><a></a>val_acc_metric <span class="op">=</span> Accuracy(task<span class="op">=</span><span class="st">"multiclass"</span>, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb65-9"><a></a></span>
<span id="cb65-10"><a></a><span class="cf">for</span> x_val, y_val, fx_val <span class="kw">in</span> tqdm(val_feat_dl):</span>
<span id="cb65-11"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb65-12"><a></a>        <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb65-13"><a></a>            x_val <span class="op">=</span> x_val.cuda()</span>
<span id="cb65-14"><a></a></span>
<span id="cb65-15"><a></a>        y_val_pred, fx_val_pred <span class="op">=</span> classifier(x_val)</span>
<span id="cb65-16"><a></a></span>
<span id="cb65-17"><a></a>        cls_loss <span class="op">=</span> classifier_loss_fn(y_val_pred.cpu(), y_val)</span>
<span id="cb65-18"><a></a>        red_loss <span class="op">=</span> reducer_loss_fn(fx_val_pred.cpu(), fx_val)</span>
<span id="cb65-19"><a></a></span>
<span id="cb65-20"><a></a>    cls_loss_epoch <span class="op">+=</span> cls_loss.item()</span>
<span id="cb65-21"><a></a>    red_loss_epoch <span class="op">+=</span> red_loss.item()</span>
<span id="cb65-22"><a></a>    </span>
<span id="cb65-23"><a></a>    val_acc_metric(y_val_pred.cpu().softmax(dim<span class="op">=</span><span class="dv">1</span>), y_val)</span>
<span id="cb65-24"><a></a></span>
<span id="cb65-25"><a></a>    n_dmso <span class="op">+=</span> <span class="bu">sum</span>(y_val <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb65-26"><a></a>    n_crispr <span class="op">+=</span> <span class="bu">sum</span>(y_val <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb65-27"><a></a>    n_orf <span class="op">+=</span> <span class="bu">sum</span>(y_val <span class="op">==</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0b3bc5a67d3646ebb0d9097f6fb9d5e3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-729096102.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      8</span> val_acc_metric <span class="ansi-blue-fg">=</span> Accuracy<span class="ansi-blue-fg">(</span>task<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">"multiclass"</span><span class="ansi-blue-fg">,</span> num_classes<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      9</span> 
<span class="ansi-green-fg">---&gt; 10</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> x_val<span class="ansi-blue-fg">,</span> y_val<span class="ansi-blue-fg">,</span> fx_val <span class="ansi-green-fg">in</span> tqdm<span class="ansi-blue-fg">(</span>val_feat_dl<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     11</span>     <span class="ansi-green-fg">with</span> torch<span class="ansi-blue-fg">.</span>no_grad<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     12</span>         <span class="ansi-green-fg">if</span> torch<span class="ansi-blue-fg">.</span>cuda<span class="ansi-blue-fg">.</span>is_available<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/tqdm/notebook.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    248</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    249</span>             it <span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__iter__<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 250</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">for</span> obj <span class="ansi-green-fg">in</span> it<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    251</span>                 <span class="ansi-red-fg"># return super(tqdm...) will not catch exception</span>
<span class="ansi-green-fg ansi-bold">    252</span>                 <span class="ansi-green-fg">yield</span> obj

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/tqdm/std.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">   1179</span> 
<span class="ansi-green-fg ansi-bold">   1180</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1181</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">for</span> obj <span class="ansi-green-fg">in</span> iterable<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1182</span>                 <span class="ansi-green-fg">yield</span> obj
<span class="ansi-green-fg ansi-bold">   1183</span>                 <span class="ansi-red-fg"># Update and possibly print the progressbar.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    732</span>                 <span class="ansi-red-fg"># TODO(https://github.com/pytorch/pytorch/issues/76750)</span>
<span class="ansi-green-fg ansi-bold">    733</span>                 self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[call-arg]</span>
<span class="ansi-green-fg">--&gt; 734</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    735</span>             self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">    736</span>             if (

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    788</span>     <span class="ansi-green-fg">def</span> _next_data<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    789</span>         index <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg">--&gt; 790</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_dataset_fetcher<span class="ansi-blue-fg">.</span>fetch<span class="ansi-blue-fg">(</span>index<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg ansi-bold">    791</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_pin_memory<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    792</span>             data <span class="ansi-blue-fg">=</span> _utils<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_pin_memory_device<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/fetch.py</span> in <span class="ansi-cyan-fg">fetch</span><span class="ansi-blue-fg">(self, possibly_batched_index)</span>
<span class="ansi-green-fg ansi-bold">     31</span>             <span class="ansi-green-fg">for</span> _ <span class="ansi-green-fg">in</span> possibly_batched_index<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     32</span>                 <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 33</span><span class="ansi-red-fg">                     </span>data<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>next<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset_iter<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     34</span>                 <span class="ansi-green-fg">except</span> StopIteration<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     35</span>                     self<span class="ansi-blue-fg">.</span>ended <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">/tmp/ipython-input-2874583140.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">     23</span> 
<span class="ansi-green-fg ansi-bold">     24</span>         <span class="ansi-green-fg">for</span> url <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_features_url<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">             </span>features_dict <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     26</span> 
<span class="ansi-green-fg ansi-bold">     27</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_reducer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(f, map_location, pickle_module, weights_only, mmap, **pickle_load_args)</span>
<span class="ansi-green-fg ansi-bold">   1482</span>         pickle_load_args<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"encoding"</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"utf-8"</span>
<span class="ansi-green-fg ansi-bold">   1483</span> 
<span class="ansi-green-fg">-&gt; 1484</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> _open_file_like<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">"rb"</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> opened_file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1485</span>         <span class="ansi-green-fg">if</span> _is_zipfile<span class="ansi-blue-fg">(</span>opened_file<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1486</span>             <span class="ansi-red-fg"># The zipfile reader is going to advance the current file position.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">_open_file_like</span><span class="ansi-blue-fg">(name_or_buffer, mode)</span>
<span class="ansi-green-fg ansi-bold">    757</span> <span class="ansi-green-fg">def</span> _open_file_like<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">:</span> FileLike<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> _opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    758</span>     <span class="ansi-green-fg">if</span> _is_path<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 759</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _open_file<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    760</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    761</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">"w"</span> <span class="ansi-green-fg">in</span> mode<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, name, mode)</span>
<span class="ansi-green-fg ansi-bold">    738</span> <span class="ansi-green-fg">class</span> _open_file<span class="ansi-blue-fg">(</span>_opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    739</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">:</span> Union<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">,</span> os<span class="ansi-blue-fg">.</span>PathLike<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 740</span><span class="ansi-red-fg">         </span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    741</span> 
<span class="ansi-green-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> __exit__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'val_features.pt'</pre>
</div>
</div>
</div>
</section>
<section id="train-the-mlp-model-4" class="slide level2 scrollable">
<h2>Train the <em>MLP</em> model</h2>
<ul class="task-list">
<li><label><input type="checkbox">Compute the proportion of samples per category in the validation set</label></li>
</ul>
<div id="319f5a97" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a></a>n_total <span class="op">=</span> n_dmso <span class="op">+</span> n_crispr <span class="op">+</span> n_orf</span>
<span id="cb66-2"><a></a>n_dmso <span class="op">/</span> n_total, n_crispr <span class="op">/</span> n_total, n_orf <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-351853166.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> n_total <span class="ansi-blue-fg">=</span> n_dmso <span class="ansi-blue-fg">+</span> n_crispr <span class="ansi-blue-fg">+</span> n_orf
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>n_dmso <span class="ansi-blue-fg">/</span> n_total<span class="ansi-blue-fg">,</span> n_crispr <span class="ansi-blue-fg">/</span> n_total<span class="ansi-blue-fg">,</span> n_orf <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Check the average loss metric of the model on the validation set</label></li>
</ul>
<div id="53dbded1" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a></a>cls_loss_epoch <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-2159926283.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>cls_loss_epoch <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<div id="49b206e6" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a></a>red_loss_epoch <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-1461694865.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>red_loss_epoch <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Compute the average accuracy of the model on the validation set</label></li>
</ul>
<div id="b0498079" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a></a>val_acc_metric.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>tensor(0.)</code></pre>
</div>
</div>
</section>
<section id="wrap-the-training-and-validation-steps-for-multiple-epochs" class="slide level2 scrollable">
<h2>Wrap the training and validation steps for multiple epochs</h2>
<p>Track the performance of the model throughout the epochs during training</p>
<ul class="task-list">
<li><label><input type="checkbox">Copy the training and validation steps into an epochs loop</label></li>
</ul>
<div id="17783747" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a></a>avg_cls_loss_trn <span class="op">=</span> []</span>
<span id="cb71-2"><a></a>avg_red_loss_trn <span class="op">=</span> []</span>
<span id="cb71-3"><a></a>avg_acc_trn <span class="op">=</span> []</span>
<span id="cb71-4"><a></a></span>
<span id="cb71-5"><a></a>avg_cls_loss_val <span class="op">=</span> []</span>
<span id="cb71-6"><a></a>avg_red_loss_val <span class="op">=</span> []</span>
<span id="cb71-7"><a></a>avg_acc_val <span class="op">=</span> []</span>
<span id="cb71-8"><a></a></span>
<span id="cb71-9"><a></a>n_epochs <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb71-10"><a></a>q <span class="op">=</span> tqdm(total<span class="op">=</span>n_epochs)</span>
<span id="cb71-11"><a></a></span>
<span id="cb71-12"><a></a><span class="cf">for</span> e <span class="kw">in</span> <span class="bu">range</span>(n_epochs):</span>
<span id="cb71-13"><a></a>    <span class="co"># Training loop</span></span>
<span id="cb71-14"><a></a>    classifier.train()</span>
<span id="cb71-15"><a></a></span>
<span id="cb71-16"><a></a>    loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb71-17"><a></a></span>
<span id="cb71-18"><a></a>    trn_acc_metric.reset()</span>
<span id="cb71-19"><a></a>    </span>
<span id="cb71-20"><a></a>    total_samples <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb71-21"><a></a>    <span class="cf">for</span> x, y, fx <span class="kw">in</span> trn_feat_dl:</span>
<span id="cb71-22"><a></a>        optimizer.zero_grad()</span>
<span id="cb71-23"><a></a></span>
<span id="cb71-24"><a></a>        <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb71-25"><a></a>            x <span class="op">=</span> x.cuda()</span>
<span id="cb71-26"><a></a></span>
<span id="cb71-27"><a></a>        y_pred, fx_pred <span class="op">=</span> classifier(x)</span>
<span id="cb71-28"><a></a></span>
<span id="cb71-29"><a></a>        cls_loss <span class="op">=</span> classifier_loss_fn(y_pred.cpu(), y)</span>
<span id="cb71-30"><a></a>        red_loss <span class="op">=</span> reducer_loss_fn(fx_pred.cpu(), fx)</span>
<span id="cb71-31"><a></a></span>
<span id="cb71-32"><a></a>        cls_loss.backward(retain_graph<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb71-33"><a></a>        red_loss.backward()</span>
<span id="cb71-34"><a></a></span>
<span id="cb71-35"><a></a>        optimizer.step()</span>
<span id="cb71-36"><a></a></span>
<span id="cb71-37"><a></a>        cls_loss_epoch <span class="op">+=</span> cls_loss.item() <span class="op">*</span> <span class="bu">len</span>(y)</span>
<span id="cb71-38"><a></a>        red_loss_epoch <span class="op">+=</span> red_loss.item() <span class="op">*</span> <span class="bu">len</span>(y)</span>
<span id="cb71-39"><a></a></span>
<span id="cb71-40"><a></a>        trn_acc_metric(y_pred.cpu().softmax(dim<span class="op">=</span><span class="dv">1</span>), y)</span>
<span id="cb71-41"><a></a>        total_samples <span class="op">+=</span> <span class="bu">len</span>(y)</span>
<span id="cb71-42"><a></a></span>
<span id="cb71-43"><a></a>    avg_cls_loss_trn.append(cls_loss_epoch <span class="op">/</span> total_samples)</span>
<span id="cb71-44"><a></a>    avg_red_loss_trn.append(red_loss_epoch <span class="op">/</span> total_samples)</span>
<span id="cb71-45"><a></a></span>
<span id="cb71-46"><a></a>    avg_acc_trn.append(trn_acc_metric.compute())</span>
<span id="cb71-47"><a></a></span>
<span id="cb71-48"><a></a>    <span class="co"># Validation loop</span></span>
<span id="cb71-49"><a></a>    classifier.<span class="bu">eval</span>()</span>
<span id="cb71-50"><a></a></span>
<span id="cb71-51"><a></a>    cls_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb71-52"><a></a>    red_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb71-53"><a></a></span>
<span id="cb71-54"><a></a>    val_acc_metric.reset()</span>
<span id="cb71-55"><a></a></span>
<span id="cb71-56"><a></a>    total_samples <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb71-57"><a></a>    <span class="cf">for</span> x_val, y_val, fx_val <span class="kw">in</span> val_feat_dl:</span>
<span id="cb71-58"><a></a>        <span class="cf">with</span> torch.no_grad():</span>
<span id="cb71-59"><a></a>            <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb71-60"><a></a>                x_val <span class="op">=</span> x_val.cuda()</span>
<span id="cb71-61"><a></a></span>
<span id="cb71-62"><a></a>            y_val_pred, fx_val_pred <span class="op">=</span> classifier(x_val)</span>
<span id="cb71-63"><a></a></span>
<span id="cb71-64"><a></a>            cls_loss <span class="op">=</span> classifier_loss_fn(y_val_pred.cpu(), y_val)</span>
<span id="cb71-65"><a></a>            red_loss <span class="op">=</span> reducer_loss_fn(fx_val_pred.cpu(), fx_val)</span>
<span id="cb71-66"><a></a></span>
<span id="cb71-67"><a></a>        cls_loss_epoch <span class="op">+=</span> cls_loss.item() <span class="op">*</span> <span class="bu">len</span>(y_val)</span>
<span id="cb71-68"><a></a>        red_loss_epoch <span class="op">+=</span> red_loss.item() <span class="op">*</span> <span class="bu">len</span>(y_val)</span>
<span id="cb71-69"><a></a></span>
<span id="cb71-70"><a></a>        val_acc_metric(y_val_pred.cpu().softmax(dim<span class="op">=</span><span class="dv">1</span>), y_val)</span>
<span id="cb71-71"><a></a>        total_samples <span class="op">+=</span> <span class="bu">len</span>(y_val)</span>
<span id="cb71-72"><a></a></span>
<span id="cb71-73"><a></a>    avg_cls_loss_val.append(cls_loss_epoch <span class="op">/</span> total_samples)</span>
<span id="cb71-74"><a></a>    avg_red_loss_val.append(red_loss_epoch <span class="op">/</span> total_samples)</span>
<span id="cb71-75"><a></a></span>
<span id="cb71-76"><a></a>    avg_acc_val.append(val_acc_metric.compute())</span>
<span id="cb71-77"><a></a></span>
<span id="cb71-78"><a></a>    q.set_description(<span class="ss">f"Average training CE loss: </span><span class="sc">{</span>avg_cls_loss_trn[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:0.4f}</span><span class="ss"> / MSE loss: </span><span class="sc">{</span>avg_red_loss_trn[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:0.4f}</span><span class="ss"> (Accuracy: </span><span class="sc">{</span><span class="dv">100</span> <span class="op">*</span> avg_acc_trn[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:0.2f}</span><span class="ss"> %). Average validation CE loss: </span><span class="sc">{</span>avg_cls_loss_val[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:04f}</span><span class="ss"> / MSE loss: </span><span class="sc">{</span>avg_red_loss_val[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:04f}</span><span class="ss"> (Accuracy: </span><span class="sc">{</span><span class="dv">100</span> <span class="op">*</span> avg_acc_val[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:0.2f}</span><span class="ss"> %)"</span>)</span>
<span id="cb71-79"><a></a>    q.update()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7759eed263f94ea8bae0146112b94493","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-4068602417.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">     19</span> 
<span class="ansi-green-fg ansi-bold">     20</span>     total_samples <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-fg">---&gt; 21</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">for</span> x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> fx <span class="ansi-green-fg">in</span> trn_feat_dl<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     22</span>         optimizer<span class="ansi-blue-fg">.</span>zero_grad<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     23</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    732</span>                 <span class="ansi-red-fg"># TODO(https://github.com/pytorch/pytorch/issues/76750)</span>
<span class="ansi-green-fg ansi-bold">    733</span>                 self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[call-arg]</span>
<span class="ansi-green-fg">--&gt; 734</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    735</span>             self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">    736</span>             if (

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">   1514</span>                 worker_id <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_task_info<span class="ansi-blue-fg">.</span>pop<span class="ansi-blue-fg">(</span>idx<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg ansi-bold">   1515</span>                 self<span class="ansi-blue-fg">.</span>_rcvd_idx <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">-&gt; 1516</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_process_data<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> worker_id<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1517</span> 
<span class="ansi-green-fg ansi-bold">   1518</span>     <span class="ansi-green-fg">def</span> _try_put_index<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_process_data</span><span class="ansi-blue-fg">(self, data, worker_idx)</span>
<span class="ansi-green-fg ansi-bold">   1549</span>         self<span class="ansi-blue-fg">.</span>_try_put_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1550</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> ExceptionWrapper<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1551</span><span class="ansi-red-fg">             </span>data<span class="ansi-blue-fg">.</span>reraise<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1552</span>         <span class="ansi-green-fg">return</span> data
<span class="ansi-green-fg ansi-bold">   1553</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/_utils.py</span> in <span class="ansi-cyan-fg">reraise</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    767</span>             <span class="ansi-red-fg"># be constructed, don't try to instantiate since we don't know how to</span>
<span class="ansi-green-fg ansi-bold">    768</span>             <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span>msg<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 769</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> exception
<span class="ansi-green-fg ansi-bold">    770</span> 
<span class="ansi-green-fg ansi-bold">    771</span> 

<span class="ansi-red-fg">FileNotFoundError</span>: Caught FileNotFoundError in DataLoader worker process 0.
Original Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/fetch.py", line 33, in fetch
    data.append(next(self.dataset_iter))
                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ipython-input-2874583140.py", line 25, in __iter__
    features_dict = torch.load(url)
                    ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 1484, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 759, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 740, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'trn_features_002.pt'
</pre>
</div>
</div>
</div>
</section>
<section id="review-the-performance-of-the-model-throughout-training" class="slide level2 scrollable">
<h2>Review the performance of the model throughout training</h2>
<ul class="task-list">
<li><label><input type="checkbox">Plot the loss function evaluation for the training and validation sets</label></li>
</ul>
<div id="8c664f36" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a></a>plt.plot(avg_cls_loss_trn, <span class="st">"k-"</span>, label<span class="op">=</span><span class="st">"Training loss"</span>)</span>
<span id="cb72-2"><a></a>plt.plot(avg_cls_loss_val, <span class="st">"b:"</span>, label<span class="op">=</span><span class="st">"Validation loss"</span>)</span>
<span id="cb72-3"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="DL_image_analysis_2_3_files/figure-revealjs/cell-63-output-1.png" width="813" height="411"></p>
</figure>
</div>
</div>
</div>
<div id="aa214409" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a></a>plt.plot(avg_red_loss_trn, <span class="st">"k-"</span>, label<span class="op">=</span><span class="st">"Training loss"</span>)</span>
<span id="cb73-2"><a></a>plt.plot(avg_red_loss_val, <span class="st">"b:"</span>, label<span class="op">=</span><span class="st">"Validation loss"</span>)</span>
<span id="cb73-3"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="DL_image_analysis_2_3_files/figure-revealjs/cell-64-output-1.png" width="813" height="411"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="review-the-performance-of-the-model-throughout-training-1" class="slide level2 scrollable">
<h2>Review the performance of the model throughout training</h2>
<ul class="task-list">
<li><label><input type="checkbox">Plot the accuracy of the model on the training and validation sets</label></li>
</ul>
<div id="0c82df57" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a></a>plt.plot(avg_acc_trn, <span class="st">"k-"</span>, label<span class="op">=</span><span class="st">"Training accuracy"</span>)</span>
<span id="cb74-2"><a></a>plt.plot(avg_acc_val, <span class="st">"b:"</span>, label<span class="op">=</span><span class="st">"Validation accuracy"</span>)</span>
<span id="cb74-3"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="DL_image_analysis_2_3_files/figure-revealjs/cell-65-output-1.png" width="813" height="411"></p>
</figure>
</div>
</div>
</div>
</section></section>
<section>
<section id="evaluate-the-model-with-the-witheld-testing-data" class="title-slide slide level1 center">
<h1>Evaluate the model with the witheld testing data</h1>

</section>
<section id="save-the-classifier-model-to-be-used-later-or-shared-with-collaborators" class="slide level2 scrollable">
<h2>Save the classifier model to be used later or shared with collaborators</h2>
<ul class="task-list">
<li><label><input type="checkbox">Evaluate the classifier on the testing set to measure its generalization capacity</label></li>
</ul>
<div id="34b75efd" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a></a><span class="im">from</span> torchmetrics.classification <span class="im">import</span> ConfusionMatrix</span>
<span id="cb75-2"><a></a></span>
<span id="cb75-3"><a></a>classifier.<span class="bu">eval</span>()</span>
<span id="cb75-4"><a></a></span>
<span id="cb75-5"><a></a>n_dmso <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-6"><a></a>n_crispr <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-7"><a></a>n_orf <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-8"><a></a></span>
<span id="cb75-9"><a></a>cls_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-10"><a></a>red_loss_epoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-11"><a></a></span>
<span id="cb75-12"><a></a>tst_acc_metric <span class="op">=</span> Accuracy(<span class="st">"multiclass"</span>, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb75-13"><a></a>tst_confmat <span class="op">=</span> ConfusionMatrix(<span class="st">"multiclass"</span>, num_classes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb75-14"><a></a></span>
<span id="cb75-15"><a></a><span class="cf">for</span> x_tst, y_tst, fx_tst <span class="kw">in</span> tst_feat_dl:</span>
<span id="cb75-16"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb75-17"><a></a>        <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb75-18"><a></a>            x_tst <span class="op">=</span> x_tst.cuda()</span>
<span id="cb75-19"><a></a></span>
<span id="cb75-20"><a></a>        y_tst_pred, fx_tst_pred <span class="op">=</span> classifier(x_tst)</span>
<span id="cb75-21"><a></a>        cls_loss <span class="op">=</span> classifier_loss_fn(y_tst_pred.cpu(), y_tst)</span>
<span id="cb75-22"><a></a>        red_loss <span class="op">=</span> reducer_loss_fn(fx_tst_pred.cpu(), fx_tst)</span>
<span id="cb75-23"><a></a></span>
<span id="cb75-24"><a></a>    cls_loss_epoch <span class="op">+=</span> cls_loss.item() <span class="op">*</span> <span class="bu">len</span>(y_tst)</span>
<span id="cb75-25"><a></a>    red_loss_epoch <span class="op">+=</span> red_loss.item() <span class="op">*</span> <span class="bu">len</span>(y_tst)</span>
<span id="cb75-26"><a></a>    </span>
<span id="cb75-27"><a></a>    y_tst_prob <span class="op">=</span> y_tst_pred.cpu().softmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb75-28"><a></a>    tst_acc_metric.update(y_tst_prob, y_tst)</span>
<span id="cb75-29"><a></a>    tst_confmat.update(y_tst_prob, y_tst)</span>
<span id="cb75-30"><a></a></span>
<span id="cb75-31"><a></a>    n_dmso <span class="op">+=</span> <span class="bu">sum</span>(y_tst <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb75-32"><a></a>    n_crispr <span class="op">+=</span> <span class="bu">sum</span>(y_tst <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb75-33"><a></a>    n_orf <span class="op">+=</span> <span class="bu">sum</span>(y_tst <span class="op">==</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-3055367780.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">     13</span> tst_confmat <span class="ansi-blue-fg">=</span> ConfusionMatrix<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"multiclass"</span><span class="ansi-blue-fg">,</span> num_classes<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     14</span> 
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> x_tst<span class="ansi-blue-fg">,</span> y_tst<span class="ansi-blue-fg">,</span> fx_tst <span class="ansi-green-fg">in</span> tst_feat_dl<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     16</span>     <span class="ansi-green-fg">with</span> torch<span class="ansi-blue-fg">.</span>no_grad<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     17</span>         <span class="ansi-green-fg">if</span> torch<span class="ansi-blue-fg">.</span>cuda<span class="ansi-blue-fg">.</span>is_available<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    732</span>                 <span class="ansi-red-fg"># TODO(https://github.com/pytorch/pytorch/issues/76750)</span>
<span class="ansi-green-fg ansi-bold">    733</span>                 self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[call-arg]</span>
<span class="ansi-green-fg">--&gt; 734</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    735</span>             self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">    736</span>             if (

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    788</span>     <span class="ansi-green-fg">def</span> _next_data<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    789</span>         index <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg">--&gt; 790</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_dataset_fetcher<span class="ansi-blue-fg">.</span>fetch<span class="ansi-blue-fg">(</span>index<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg ansi-bold">    791</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_pin_memory<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    792</span>             data <span class="ansi-blue-fg">=</span> _utils<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_pin_memory_device<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/fetch.py</span> in <span class="ansi-cyan-fg">fetch</span><span class="ansi-blue-fg">(self, possibly_batched_index)</span>
<span class="ansi-green-fg ansi-bold">     31</span>             <span class="ansi-green-fg">for</span> _ <span class="ansi-green-fg">in</span> possibly_batched_index<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     32</span>                 <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 33</span><span class="ansi-red-fg">                     </span>data<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>next<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset_iter<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     34</span>                 <span class="ansi-green-fg">except</span> StopIteration<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     35</span>                     self<span class="ansi-blue-fg">.</span>ended <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">/tmp/ipython-input-2874583140.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">     23</span> 
<span class="ansi-green-fg ansi-bold">     24</span>         <span class="ansi-green-fg">for</span> url <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_features_url<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">             </span>features_dict <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     26</span> 
<span class="ansi-green-fg ansi-bold">     27</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_reducer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(f, map_location, pickle_module, weights_only, mmap, **pickle_load_args)</span>
<span class="ansi-green-fg ansi-bold">   1482</span>         pickle_load_args<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"encoding"</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"utf-8"</span>
<span class="ansi-green-fg ansi-bold">   1483</span> 
<span class="ansi-green-fg">-&gt; 1484</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> _open_file_like<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">"rb"</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> opened_file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1485</span>         <span class="ansi-green-fg">if</span> _is_zipfile<span class="ansi-blue-fg">(</span>opened_file<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1486</span>             <span class="ansi-red-fg"># The zipfile reader is going to advance the current file position.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">_open_file_like</span><span class="ansi-blue-fg">(name_or_buffer, mode)</span>
<span class="ansi-green-fg ansi-bold">    757</span> <span class="ansi-green-fg">def</span> _open_file_like<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">:</span> FileLike<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> _opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    758</span>     <span class="ansi-green-fg">if</span> _is_path<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 759</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _open_file<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    760</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    761</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">"w"</span> <span class="ansi-green-fg">in</span> mode<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, name, mode)</span>
<span class="ansi-green-fg ansi-bold">    738</span> <span class="ansi-green-fg">class</span> _open_file<span class="ansi-blue-fg">(</span>_opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    739</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">:</span> Union<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">,</span> os<span class="ansi-blue-fg">.</span>PathLike<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 740</span><span class="ansi-red-fg">         </span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    741</span> 
<span class="ansi-green-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> __exit__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'tst_features.pt'</pre>
</div>
</div>
</div>
</section>
<section id="save-the-classifier-model-to-be-used-later-or-shared-with-collaborators-1" class="slide level2 scrollable">
<h2>Save the classifier model to be used later or shared with collaborators</h2>
<ul class="task-list">
<li><label><input type="checkbox">Check the proportion of types of perturbation in the testing set</label></li>
</ul>
<div id="413a34ec" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a></a>n_total <span class="op">=</span> n_dmso <span class="op">+</span> n_crispr <span class="op">+</span> n_orf</span>
<span id="cb76-2"><a></a>n_dmso <span class="op">/</span> n_total, n_crispr <span class="op">/</span> n_total, n_orf <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-351853166.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> n_total <span class="ansi-blue-fg">=</span> n_dmso <span class="ansi-blue-fg">+</span> n_crispr <span class="ansi-blue-fg">+</span> n_orf
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>n_dmso <span class="ansi-blue-fg">/</span> n_total<span class="ansi-blue-fg">,</span> n_crispr <span class="ansi-blue-fg">/</span> n_total<span class="ansi-blue-fg">,</span> n_orf <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Check the loss metrics on the testing set</label></li>
</ul>
<div id="2e7da225" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a></a>cls_loss_epoch <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-2159926283.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>cls_loss_epoch <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<div id="cf508a9c" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a></a>red_loss_epoch <span class="op">/</span> n_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-1461694865.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>red_loss_epoch <span class="ansi-blue-fg">/</span> n_total

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
</section>
<section id="save-the-classifier-model-to-be-used-later-or-shared-with-collaborators-2" class="slide level2 scrollable">
<h2>Save the classifier model to be used later or shared with collaborators</h2>
<ul class="task-list">
<li><label><input type="checkbox">Check the accuracy metrics on the testing set</label></li>
</ul>
<div id="d25fc3e7" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a></a>tst_acc_metric.compute()</span>
<span id="cb79-2"><a></a>tst_confmat.compute()</span>
<span id="cb79-3"><a></a>tst_confmat.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>(&lt;Figure size 640x480 with 1 Axes&gt;,
 &lt;Axes: xlabel='Predicted class', ylabel='True class'&gt;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="DL_image_analysis_2_3_files/figure-revealjs/cell-70-output-2.png" width="489" height="491"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluate-the-capacity-to-mimic-the-umap-dimensionality-reduction" class="slide level2 scrollable">
<h2>Evaluate the capacity to mimic the UMap dimensionality reduction</h2>
<ul class="task-list">
<li><label><input type="checkbox">Get the embeddings from the trained model for the training set</label></li>
</ul>
<div id="6ff6c073" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a></a>trn_fx <span class="op">=</span> []</span>
<span id="cb81-2"><a></a>trn_fx_pred <span class="op">=</span> []</span>
<span id="cb81-3"><a></a>trn_y <span class="op">=</span> []</span>
<span id="cb81-4"><a></a></span>
<span id="cb81-5"><a></a><span class="cf">for</span> i, (x, y, fx) <span class="kw">in</span> <span class="bu">enumerate</span>(trn_feat_dl):</span>
<span id="cb81-6"><a></a>    <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">10</span>:</span>
<span id="cb81-7"><a></a>        <span class="cf">break</span></span>
<span id="cb81-8"><a></a></span>
<span id="cb81-9"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb81-10"><a></a>        <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb81-11"><a></a>            x <span class="op">=</span> x.cuda()</span>
<span id="cb81-12"><a></a></span>
<span id="cb81-13"><a></a>        _, fx_pred <span class="op">=</span> classifier(x)</span>
<span id="cb81-14"><a></a>        trn_fx_pred.append(fx_pred.detach().cpu())</span>
<span id="cb81-15"><a></a>        trn_fx.append(fx)</span>
<span id="cb81-16"><a></a>        trn_y.append(y)</span>
<span id="cb81-17"><a></a></span>
<span id="cb81-18"><a></a>trn_fx <span class="op">=</span> torch.cat(trn_fx, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb81-19"><a></a>trn_fx_pred <span class="op">=</span> torch.cat(trn_fx_pred, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb81-20"><a></a>trn_y <span class="op">=</span> torch.cat(trn_y, dim<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-296939953.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      3</span> trn_y <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg ansi-bold">      4</span> 
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> i<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> fx<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>trn_feat_dl<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">      6</span>     <span class="ansi-green-fg">if</span> i <span class="ansi-blue-fg">&gt;=</span> <span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">      7</span>         <span class="ansi-green-fg">break</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    732</span>                 <span class="ansi-red-fg"># TODO(https://github.com/pytorch/pytorch/issues/76750)</span>
<span class="ansi-green-fg ansi-bold">    733</span>                 self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[call-arg]</span>
<span class="ansi-green-fg">--&gt; 734</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    735</span>             self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">    736</span>             if (

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">   1514</span>                 worker_id <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_task_info<span class="ansi-blue-fg">.</span>pop<span class="ansi-blue-fg">(</span>idx<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg ansi-bold">   1515</span>                 self<span class="ansi-blue-fg">.</span>_rcvd_idx <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">-&gt; 1516</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_process_data<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> worker_id<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1517</span> 
<span class="ansi-green-fg ansi-bold">   1518</span>     <span class="ansi-green-fg">def</span> _try_put_index<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_process_data</span><span class="ansi-blue-fg">(self, data, worker_idx)</span>
<span class="ansi-green-fg ansi-bold">   1549</span>         self<span class="ansi-blue-fg">.</span>_try_put_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1550</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> ExceptionWrapper<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1551</span><span class="ansi-red-fg">             </span>data<span class="ansi-blue-fg">.</span>reraise<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1552</span>         <span class="ansi-green-fg">return</span> data
<span class="ansi-green-fg ansi-bold">   1553</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/_utils.py</span> in <span class="ansi-cyan-fg">reraise</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    767</span>             <span class="ansi-red-fg"># be constructed, don't try to instantiate since we don't know how to</span>
<span class="ansi-green-fg ansi-bold">    768</span>             <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span>msg<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 769</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> exception
<span class="ansi-green-fg ansi-bold">    770</span> 
<span class="ansi-green-fg ansi-bold">    771</span> 

<span class="ansi-red-fg">FileNotFoundError</span>: Caught FileNotFoundError in DataLoader worker process 0.
Original Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/fetch.py", line 33, in fetch
    data.append(next(self.dataset_iter))
                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ipython-input-2874583140.py", line 25, in __iter__
    features_dict = torch.load(url)
                    ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 1484, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 759, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/serialization.py", line 740, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'trn_features_006.pt'
</pre>
</div>
</div>
</div>
</section>
<section id="evaluate-the-capacity-to-mimic-the-umap-dimensionality-reduction-1" class="slide level2 scrollable">
<h2>Evaluate the capacity to mimic the UMap dimensionality reduction</h2>
<ul class="task-list">
<li><label><input type="checkbox">Compate the embedding spaces (UMap vs learned) with the training set</label></li>
</ul>
<div id="c948abce" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names):</span>
<span id="cb82-2"><a></a>    plt.scatter(trn_fx[trn_y <span class="op">==</span> class_idx, <span class="dv">0</span>], trn_fx[trn_y <span class="op">==</span> class_idx, <span class="dv">1</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb82-3"><a></a></span>
<span id="cb82-4"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-4170264153.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-green-fg">for</span> class_idx<span class="ansi-blue-fg">,</span> class_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>class_names<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>trn_fx<span class="ansi-blue-fg">[</span>trn_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> trn_fx<span class="ansi-blue-fg">[</span>trn_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      3</span> 
<span class="ansi-green-fg ansi-bold">      4</span> plt<span class="ansi-blue-fg">.</span>legend<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: list indices must be integers or slices, not tuple</pre>
</div>
</div>
</div>
<div id="f9ae57cb" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names):</span>
<span id="cb83-2"><a></a>    plt.scatter(trn_fx_pred[trn_y <span class="op">==</span> class_idx, <span class="dv">0</span>], trn_fx_pred[trn_y <span class="op">==</span> class_idx, <span class="dv">1</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb83-3"><a></a></span>
<span id="cb83-4"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-1926387892.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-green-fg">for</span> class_idx<span class="ansi-blue-fg">,</span> class_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>class_names<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>trn_fx_pred<span class="ansi-blue-fg">[</span>trn_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> trn_fx_pred<span class="ansi-blue-fg">[</span>trn_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      3</span> 
<span class="ansi-green-fg ansi-bold">      4</span> plt<span class="ansi-blue-fg">.</span>legend<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: list indices must be integers or slices, not tuple</pre>
</div>
</div>
</div>
</section>
<section id="evaluate-the-capacity-to-mimic-the-umap-dimensionality-reduction-2" class="slide level2 scrollable">
<h2>Evaluate the capacity to mimic the UMap dimensionality reduction</h2>
<ul class="task-list">
<li><label><input type="checkbox">Get the embeddings from the trained model for the validation set</label></li>
</ul>
<div id="35e1daf0" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a></a>val_fx <span class="op">=</span> []</span>
<span id="cb84-2"><a></a>val_fx_pred <span class="op">=</span> []</span>
<span id="cb84-3"><a></a>val_y <span class="op">=</span> []</span>
<span id="cb84-4"><a></a></span>
<span id="cb84-5"><a></a><span class="cf">for</span> i, (x_val, y_val, fx_val) <span class="kw">in</span> <span class="bu">enumerate</span>(val_feat_dl):</span>
<span id="cb84-6"><a></a>    <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">10</span>:</span>
<span id="cb84-7"><a></a>        <span class="cf">break</span></span>
<span id="cb84-8"><a></a></span>
<span id="cb84-9"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb84-10"><a></a>        <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb84-11"><a></a>            x_val <span class="op">=</span> x_val.cuda()</span>
<span id="cb84-12"><a></a></span>
<span id="cb84-13"><a></a>        _, fx_pred_val <span class="op">=</span> classifier(x_val)</span>
<span id="cb84-14"><a></a>        val_fx_pred.append(fx_pred_val.detach().cpu())</span>
<span id="cb84-15"><a></a>        val_fx.append(fx_val)</span>
<span id="cb84-16"><a></a>        val_y.append(y_val)</span>
<span id="cb84-17"><a></a></span>
<span id="cb84-18"><a></a>val_fx <span class="op">=</span> torch.cat(val_fx, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb84-19"><a></a>val_fx_pred <span class="op">=</span> torch.cat(val_fx_pred, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb84-20"><a></a>val_y <span class="op">=</span> torch.cat(val_y, dim<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-402407764.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      3</span> val_y <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg ansi-bold">      4</span> 
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> i<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>x_val<span class="ansi-blue-fg">,</span> y_val<span class="ansi-blue-fg">,</span> fx_val<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>val_feat_dl<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">      6</span>     <span class="ansi-green-fg">if</span> i <span class="ansi-blue-fg">&gt;=</span> <span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">      7</span>         <span class="ansi-green-fg">break</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    732</span>                 <span class="ansi-red-fg"># TODO(https://github.com/pytorch/pytorch/issues/76750)</span>
<span class="ansi-green-fg ansi-bold">    733</span>                 self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[call-arg]</span>
<span class="ansi-green-fg">--&gt; 734</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    735</span>             self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">    736</span>             if (

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    788</span>     <span class="ansi-green-fg">def</span> _next_data<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    789</span>         index <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg">--&gt; 790</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_dataset_fetcher<span class="ansi-blue-fg">.</span>fetch<span class="ansi-blue-fg">(</span>index<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg ansi-bold">    791</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_pin_memory<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    792</span>             data <span class="ansi-blue-fg">=</span> _utils<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_pin_memory_device<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/utils/data/_utils/fetch.py</span> in <span class="ansi-cyan-fg">fetch</span><span class="ansi-blue-fg">(self, possibly_batched_index)</span>
<span class="ansi-green-fg ansi-bold">     31</span>             <span class="ansi-green-fg">for</span> _ <span class="ansi-green-fg">in</span> possibly_batched_index<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     32</span>                 <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 33</span><span class="ansi-red-fg">                     </span>data<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>next<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset_iter<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     34</span>                 <span class="ansi-green-fg">except</span> StopIteration<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">     35</span>                     self<span class="ansi-blue-fg">.</span>ended <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">/tmp/ipython-input-2874583140.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">     23</span> 
<span class="ansi-green-fg ansi-bold">     24</span>         <span class="ansi-green-fg">for</span> url <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_features_url<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">             </span>features_dict <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     26</span> 
<span class="ansi-green-fg ansi-bold">     27</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_reducer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(f, map_location, pickle_module, weights_only, mmap, **pickle_load_args)</span>
<span class="ansi-green-fg ansi-bold">   1482</span>         pickle_load_args<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">"encoding"</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"utf-8"</span>
<span class="ansi-green-fg ansi-bold">   1483</span> 
<span class="ansi-green-fg">-&gt; 1484</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> _open_file_like<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">"rb"</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> opened_file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1485</span>         <span class="ansi-green-fg">if</span> _is_zipfile<span class="ansi-blue-fg">(</span>opened_file<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">   1486</span>             <span class="ansi-red-fg"># The zipfile reader is going to advance the current file position.</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">_open_file_like</span><span class="ansi-blue-fg">(name_or_buffer, mode)</span>
<span class="ansi-green-fg ansi-bold">    757</span> <span class="ansi-green-fg">def</span> _open_file_like<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">:</span> FileLike<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> _opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    758</span>     <span class="ansi-green-fg">if</span> _is_path<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 759</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _open_file<span class="ansi-blue-fg">(</span>name_or_buffer<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    760</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    761</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">"w"</span> <span class="ansi-green-fg">in</span> mode<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.12/dist-packages/torch/serialization.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, name, mode)</span>
<span class="ansi-green-fg ansi-bold">    738</span> <span class="ansi-green-fg">class</span> _open_file<span class="ansi-blue-fg">(</span>_opener<span class="ansi-blue-fg">[</span>IO<span class="ansi-blue-fg">[</span>bytes<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    739</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">:</span> Union<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">,</span> os<span class="ansi-blue-fg">.</span>PathLike<span class="ansi-blue-fg">[</span>str<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">:</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 740</span><span class="ansi-red-fg">         </span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    741</span> 
<span class="ansi-green-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> __exit__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'val_features.pt'</pre>
</div>
</div>
</div>
</section>
<section id="evaluate-the-capacity-to-mimic-the-umap-dimensionality-reduction-3" class="slide level2 scrollable">
<h2>Evaluate the capacity to mimic the UMap dimensionality reduction</h2>
<ul class="task-list">
<li><label><input type="checkbox">Compate the embedding spaces (UMap vs learned) with the validation set</label></li>
</ul>
<div id="9ee075dd" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names):</span>
<span id="cb85-2"><a></a>    plt.scatter(val_fx[val_y <span class="op">==</span> class_idx, <span class="dv">0</span>], val_fx[val_y <span class="op">==</span> class_idx, <span class="dv">1</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb85-3"><a></a></span>
<span id="cb85-4"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-684093476.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-green-fg">for</span> class_idx<span class="ansi-blue-fg">,</span> class_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>class_names<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>val_fx<span class="ansi-blue-fg">[</span>val_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> val_fx<span class="ansi-blue-fg">[</span>val_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      3</span> 
<span class="ansi-green-fg ansi-bold">      4</span> plt<span class="ansi-blue-fg">.</span>legend<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: list indices must be integers or slices, not tuple</pre>
</div>
</div>
</div>
<div id="3228f00b" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names):</span>
<span id="cb86-2"><a></a>    plt.scatter(val_fx_pred[val_y <span class="op">==</span> class_idx, <span class="dv">0</span>], val_fx_pred[val_y <span class="op">==</span> class_idx, <span class="dv">1</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb86-3"><a></a></span>
<span id="cb86-4"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-2487391935.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-green-fg">for</span> class_idx<span class="ansi-blue-fg">,</span> class_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>class_names<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>val_fx_pred<span class="ansi-blue-fg">[</span>val_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> val_fx_pred<span class="ansi-blue-fg">[</span>val_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      3</span> 
<span class="ansi-green-fg ansi-bold">      4</span> plt<span class="ansi-blue-fg">.</span>legend<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: list indices must be integers or slices, not tuple</pre>
</div>
</div>
</div>
</section></section>
<section>
<section id="use-the-pre-trained-model-to-identify-the-behavior-of-compounds" class="title-slide slide level1 center">
<h1>Use the pre-trained model to identify the behavior of compounds</h1>
<p>Because the model has learned to recognize <em>CRISPR</em>, <em>ORF</em>, and <em>NONE/DMSO</em> effects, it can be used to determine the behavior of any treatment based on their morphological profile.</p>
<p>To do so, first extract the the morphological features using the pre-trained <em>MobileNet</em>, and then use the extracted features as input for the classifier model.</p>
</section>
<section id="execute-the-feature-extraction-and-classification-pipeline-for-compound-data" class="slide level2 scrollable">
<h2>Execute the feature extraction and classification pipeline for <em>compound</em> data</h2>
<div id="809f8d55" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a></a>compounds_ds <span class="op">=</span> TiffS3Dataset(comp_plate_maps, wells_metadata, comp_plate_maps[<span class="st">"Plate_name"</span>].tolist(), <span class="dv">16</span>, <span class="dv">24</span>, <span class="dv">9</span>, <span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb87-2"><a></a></span>
<span id="cb87-3"><a></a>batch_size <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb87-4"><a></a></span>
<span id="cb87-5"><a></a>compounds_dl <span class="op">=</span> DataLoader(compounds_ds, batch_size<span class="op">=</span>batch_size, num_workers<span class="op">=</span><span class="dv">2</span>, worker_init_fn<span class="op">=</span>dataset_worker_init_fn)</span>
<span id="cb87-6"><a></a></span>
<span id="cb87-7"><a></a>metadata_list <span class="op">=</span> []</span>
<span id="cb87-8"><a></a><span class="cf">for</span> i, (x, y, metadata) <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(compounds_dl)):</span>
<span id="cb87-9"><a></a>    metadata_list.append(metadata)</span>
<span id="cb87-10"><a></a></span>
<span id="cb87-11"><a></a>    b, c, h, w <span class="op">=</span> x.shape</span>
<span id="cb87-12"><a></a>    x_t <span class="op">=</span> model_transforms(torch.tile(x.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, h, w), (<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb87-13"><a></a></span>
<span id="cb87-14"><a></a>    <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb87-15"><a></a>        x_t <span class="op">=</span> x_t.cuda()</span>
<span id="cb87-16"><a></a></span>
<span id="cb87-17"><a></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb87-18"><a></a>        x_out <span class="op">=</span> model(x_t)</span>
<span id="cb87-19"><a></a>        x_out <span class="op">=</span> x_out.detach().reshape(<span class="op">-</span><span class="dv">1</span>, c, <span class="dv">576</span>, <span class="dv">7</span>, <span class="dv">7</span>).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb87-20"><a></a>        x_out <span class="op">=</span> org_avgpool(x_out).detach().reshape(b, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb87-21"><a></a></span>
<span id="cb87-22"><a></a>        y_pred, fx_pred <span class="op">=</span> classifier(x_out)</span>
<span id="cb87-23"><a></a></span>
<span id="cb87-24"><a></a>    <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6ebf69a3e3b74e76a1e4a0445a3e9b06","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed retrieving: s3://cellpainting-gallery/cpg0016-jump/source_2/images/20210823_Batch_10/images/1086292105/1086292105_L14_T0001F009L01A01Z01C01.tif
Failed retrieving: s3://cellpainting-gallery/cpg0016-jump/source_2/images/20210816_Batch_9/images/1086292396/1086292396_G01_T0001F008L01A01Z01C01.tif</code></pre>
</div>
</div>
</section>
<section id="execute-the-feature-extraction-and-classification-pipeline-for-compound-data-1" class="slide level2 scrollable">
<h2>Execute the feature extraction and classification pipeline for <em>compound</em> data</h2>
<ul class="task-list">
<li><label><input type="checkbox">Plot the embeddings of the compound samples</label></li>
</ul>
<div id="3687e777" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a></a><span class="cf">for</span> class_idx, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(class_names[:<span class="dv">3</span>]):</span>
<span id="cb89-2"><a></a>    plt.scatter(trn_fx_pred[trn_y <span class="op">==</span> class_idx, <span class="dv">0</span>][::<span class="dv">10</span>], trn_fx_pred[trn_y <span class="op">==</span> class_idx, <span class="dv">1</span>][::<span class="dv">10</span>], label<span class="op">=</span>class_names[class_idx], marker<span class="op">=</span>class_markers[class_idx], facecolors<span class="op">=</span>class_facecolors[class_idx], edgecolors<span class="op">=</span>class_colors[class_idx])</span>
<span id="cb89-3"><a></a></span>
<span id="cb89-4"><a></a>plt.scatter(fx_pred.cpu()[:, <span class="dv">0</span>], fx_pred.cpu()[:, <span class="dv">1</span>], label<span class="op">=</span>class_names[<span class="dv">3</span>], marker<span class="op">=</span>class_markers[<span class="dv">3</span>], facecolors<span class="op">=</span>class_facecolors[<span class="dv">3</span>], edgecolors<span class="op">=</span>class_colors[<span class="dv">3</span>])</span>
<span id="cb89-5"><a></a></span>
<span id="cb89-6"><a></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipython-input-755015200.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-green-fg">for</span> class_idx<span class="ansi-blue-fg">,</span> class_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>class_names<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>trn_fx_pred<span class="ansi-blue-fg">[</span>trn_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> trn_fx_pred<span class="ansi-blue-fg">[</span>trn_y <span class="ansi-blue-fg">==</span> class_idx<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span>class_idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      3</span> 
<span class="ansi-green-fg ansi-bold">      4</span> plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>fx_pred<span class="ansi-blue-fg">.</span>cpu<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> fx_pred<span class="ansi-blue-fg">.</span>cpu<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span>class_names<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> marker<span class="ansi-blue-fg">=</span>class_markers<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> facecolors<span class="ansi-blue-fg">=</span>class_facecolors<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> edgecolors<span class="ansi-blue-fg">=</span>class_colors<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">      5</span> 

<span class="ansi-red-fg">TypeError</span>: list indices must be integers or slices, not tuple</pre>
</div>
</div>
</div>
</section>
<section id="execute-the-feature-extraction-and-classification-pipeline-for-compound-data-2" class="slide level2 scrollable">
<h2>Execute the feature extraction and classification pipeline for <em>compound</em> data</h2>
<ul class="task-list">
<li><label><input type="checkbox">Look for any interesting compounds in <a href="https://pubchem.ncbi.nlm.nih.gov/">PubChem</a></label></li>
</ul>
<div id="008ec759" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a></a>metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>{'Plate_name': ['GR00004377',
  'J12455d',
  'P01_ACPJUM062',
  '110000296341',
  '1086293409'],
 'Source_name': ['source_9', 'source_3', 'source_5', 'source_6', 'source_2'],
 'Batch_name': ['20210918-Run12',
  'CP_26_all_Phenix1',
  'JUMPCPE-20210716-Run12_20210719_162047',
  'p210920CPU2OS48hw384exp028JUMP',
  '20210726_Batch_7'],
 'Plate_type': ['COMPOUND', 'COMPOUND', 'COMPOUND', 'COMPOUND', 'COMPOUND'],
 'Plate_path': ['GR00004377',
  'J12455d__2021-09-24T16_30_28-Measurement1',
  'P01_ACPJUM062',
  '110000296341',
  '1086293409'],
 'Well_position': ['H02', 'P20', 'K14', 'G20', 'C01']}</code></pre>
</div>
</div>
<div id="2c723a2e" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a></a>y_pred.argmax(dim<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>tensor([1, 1, 1, 1, 1])</code></pre>
</div>
</div>
<div id="590cf821" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a></a>wells_metadata.query(<span class="st">"well_position == 'H13' &amp; Plate_type=='COMPOUND'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">

  <div id="df-0fdbd1cb-4c34-47e6-8361-d0a2b362b9e8" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">well_position</th>
<th data-quarto-table-cell-role="th">broad_sample</th>
<th data-quarto-table-cell-role="th">solvent</th>
<th data-quarto-table-cell-role="th">Plate_type</th>
<th data-quarto-table-cell-role="th">Plate_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">180</td>
<td>H13</td>
<td>NaN</td>
<td>DMSO</td>
<td>COMPOUND</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
    <div class="colab-df-buttons">
      
  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-0fdbd1cb-4c34-47e6-8361-d0a2b362b9e8')" title="Convert this dataframe to an interactive table." style="display:none;">
      
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>
    
  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-0fdbd1cb-4c34-47e6-8361-d0a2b362b9e8 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-0fdbd1cb-4c34-47e6-8361-d0a2b362b9e8');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>
  
    </div>
  </div>
  
</div>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script type="application/vnd.jupyter.widget-state+json">
    {"state":{"01569450f9224691b2ffe5254a8c89fe":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"02c1cf745c534bceb98c12b5bdb9dab0":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"08a658df8f65443ba424a102af65ed57":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"08d30d0518f1469aa9a71498bc5f5165":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"0a51b40ec6db4465bd743aa053b7164e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_2cab4de73cc64a0f9d087d15104e4d0c","placeholder":"​","style":"IPY_MODEL_26193c4768d742d293c77098291b39bc","value":""}},"0b3bc5a67d3646ebb0d9097f6fb9d5e3":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_0a51b40ec6db4465bd743aa053b7164e","IPY_MODEL_0d5a946d3f4e4841abbd81d0a8c28aa6","IPY_MODEL_4f34c087e6334ef4ab938c376a88c406"],"layout":"IPY_MODEL_4ea6d1b8244f46df9a2a43852de002fc"}},"0c82ac7a455949cfab50624b6fb2b456":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_855096cb661c4a8eba0a2221e0baf181","placeholder":"​","style":"IPY_MODEL_c9c4f52d21db4e36865ab7bdc51c391a","value":""}},"0d5a946d3f4e4841abbd81d0a8c28aa6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_08d30d0518f1469aa9a71498bc5f5165","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_3fb63a4fa21f4821b2d87965917c32d0","value":0}},"1360be5ed1d147818f8c088c6efe4ef4":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6e665e4308d1429baf9e196568f9a434","placeholder":"​","style":"IPY_MODEL_d2bbc9e1a4d84bc08baf6f6faf225192","value":" 0/? [00:11&lt;?, ?it/s]"}},"13cdb7a769584a5c992671c21614bc82":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"158f7062a8f749c39f8533ba5ca18bc9":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_c60d19912255458ca10d72454d0e891e","IPY_MODEL_45b331c0bf6b4e0991cedf9608a0d064","IPY_MODEL_a3c6bd43f3b641ebb542572ced0b0dd3"],"layout":"IPY_MODEL_18e7da66e26e4b54b56735164ca5b458"}},"18e7da66e26e4b54b56735164ca5b458":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1a54639c62b94e14a3ec32f1ae9ab9e5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_ed55ca8a0e484319a3751a0708c8c948","placeholder":"​","style":"IPY_MODEL_fac7b5ac8c4e48f697dab61308f92f2f","value":" 0/? [00:05&lt;?, ?it/s]"}},"21a3d3cbae5f48f8975ac04eded252a0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_0c82ac7a455949cfab50624b6fb2b456","IPY_MODEL_50fd9687c6d74cbb9728837ac836beff","IPY_MODEL_1360be5ed1d147818f8c088c6efe4ef4"],"layout":"IPY_MODEL_7e433d24f19742408dc6b22be2fc56e1"}},"26193c4768d742d293c77098291b39bc":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2ca2bac1c72a49dc9f28526deb863178":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2cab4de73cc64a0f9d087d15104e4d0c":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2cd0e0dbc0f540f5b473d0f9d88181de":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2dc06d1e51c843b78aaf6733ac3a59a5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2f6fee7aebbf4f95bc841b55fc58e556":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"30e35cc355184b1d8aefdd48f8db8240":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"36156fc8e12146a0a5122d06efeb5b92":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"3e48840baa2f4cebb9721e3fa0eb264f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b8feb144726f4611b4f5b855db4fae2a","placeholder":"​","style":"IPY_MODEL_2ca2bac1c72a49dc9f28526deb863178","value":" 0/20 [00:00&lt;?, ?it/s]"}},"3eb72541a3a5487f8663a267b47e0c62":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_7fb587d905f14c55a831e58d08c6115f","max":1000,"min":0,"orientation":"horizontal","style":"IPY_MODEL_7234c1c1fdc2400197bf9ed066304cd0","value":0}},"3fb63a4fa21f4821b2d87965917c32d0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"45b331c0bf6b4e0991cedf9608a0d064":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_cfca5fb6bdf846edb5e724af62007ec5","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9f79d43ac1e64114a47df9673fe5cbed","value":0}},"4b26eb588d02435ca5908f43d36c4509":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"4ea6d1b8244f46df9a2a43852de002fc":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4f34c087e6334ef4ab938c376a88c406":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b100676b348d4e8786544bfbbc3bc5f7","placeholder":"​","style":"IPY_MODEL_db228e2759ee470a927e3bc1de9ef0a2","value":" 0/? [00:00&lt;?, ?it/s]"}},"50fd9687c6d74cbb9728837ac836beff":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_b80a62f70250487aa4c3324191a72e94","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_584575b5db524682b6af9917764ff5f4","value":0}},"54a06fe920a24ab297a91603b6d46c5e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"584575b5db524682b6af9917764ff5f4":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5c7c7ea87af8477d947de6cce5ad87ab":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"67fab24f8a1e425aae223ee9f5608dc8":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6a016012285844f9974cc93f340412fb":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6d3e635ee37d4c1ebde4339c905bf729":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_c8db8d8029bc4aeeb6ae7a6b97cebefc","IPY_MODEL_3eb72541a3a5487f8663a267b47e0c62","IPY_MODEL_8f3c24d4ffe0436fb6ebcc7653177478"],"layout":"IPY_MODEL_b06656687c43468d99646778e4a1d64b"}},"6e665e4308d1429baf9e196568f9a434":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6ebf69a3e3b74e76a1e4a0445a3e9b06":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e557df0b004e428aaa4deaf5dc749dc5","IPY_MODEL_a9e9b1eee0244538abbb17eba1f233fc","IPY_MODEL_1a54639c62b94e14a3ec32f1ae9ab9e5"],"layout":"IPY_MODEL_ea687b4ac76847f49f8bab2f61d4d326"}},"7234c1c1fdc2400197bf9ed066304cd0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"7759eed263f94ea8bae0146112b94493":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_c9844ee3e0694b80948ca177a6c0e091","IPY_MODEL_fe4838d1490e40da87d267f8229d96e1","IPY_MODEL_3e48840baa2f4cebb9721e3fa0eb264f"],"layout":"IPY_MODEL_02c1cf745c534bceb98c12b5bdb9dab0"}},"7bdf30486b93409f986e1d33c504ce88":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"7e433d24f19742408dc6b22be2fc56e1":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7f4eb26c464143cc8632282e8b64ac72":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7fb587d905f14c55a831e58d08c6115f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"855096cb661c4a8eba0a2221e0baf181":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8a77e23ad4e44946a863fd65cbce3ba5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"8f3c24d4ffe0436fb6ebcc7653177478":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6a016012285844f9974cc93f340412fb","placeholder":"​","style":"IPY_MODEL_08a658df8f65443ba424a102af65ed57","value":" 0/1000 [00:00&lt;?, ?it/s]"}},"8fb130c860914a9a95a479f9ad3721fd":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"9da81a911caf41479a3e1ef2bdabf25c":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9f79d43ac1e64114a47df9673fe5cbed":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"a3c6bd43f3b641ebb542572ced0b0dd3":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_67fab24f8a1e425aae223ee9f5608dc8","placeholder":"​","style":"IPY_MODEL_8a77e23ad4e44946a863fd65cbce3ba5","value":" 0/? [00:11&lt;?, ?it/s]"}},"a985e0e77ef94a5da75da3f15574b9c1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_01569450f9224691b2ffe5254a8c89fe","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_de28e9a4c50d48dbb290206f3d44e281","value":0}},"a9dbde349d21442b93acbb7e58aae552":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_30e35cc355184b1d8aefdd48f8db8240","placeholder":"​","style":"IPY_MODEL_13cdb7a769584a5c992671c21614bc82","value":" 0/? [00:11&lt;?, ?it/s]"}},"a9e9b1eee0244538abbb17eba1f233fc":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_4b26eb588d02435ca5908f43d36c4509","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_36156fc8e12146a0a5122d06efeb5b92","value":0}},"b06656687c43468d99646778e4a1d64b":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b100676b348d4e8786544bfbbc3bc5f7":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b80a62f70250487aa4c3324191a72e94":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"b8feb144726f4611b4f5b855db4fae2a":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c60d19912255458ca10d72454d0e891e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_7f4eb26c464143cc8632282e8b64ac72","placeholder":"​","style":"IPY_MODEL_c677961f2a6e42afb0eb98b13f9bb304","value":""}},"c677961f2a6e42afb0eb98b13f9bb304":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"c8db8d8029bc4aeeb6ae7a6b97cebefc":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_2cd0e0dbc0f540f5b473d0f9d88181de","placeholder":"​","style":"IPY_MODEL_7bdf30486b93409f986e1d33c504ce88","value":"  0%"}},"c9844ee3e0694b80948ca177a6c0e091":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f076624978454011a3b8294b169fed15","placeholder":"​","style":"IPY_MODEL_2dc06d1e51c843b78aaf6733ac3a59a5","value":"  0%"}},"c9c4f52d21db4e36865ab7bdc51c391a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cfca5fb6bdf846edb5e724af62007ec5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"d2bbc9e1a4d84bc08baf6f6faf225192":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"d9b02cdbd72747a6a2306f40f0fb0ef3":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_feffb03d858149bda0e01a7bd2f7bb30","IPY_MODEL_a985e0e77ef94a5da75da3f15574b9c1","IPY_MODEL_a9dbde349d21442b93acbb7e58aae552"],"layout":"IPY_MODEL_e9b0e212bb894121b28e1c4fdc17f50d"}},"db228e2759ee470a927e3bc1de9ef0a2":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"de28e9a4c50d48dbb290206f3d44e281":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e557df0b004e428aaa4deaf5dc749dc5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_2f6fee7aebbf4f95bc841b55fc58e556","placeholder":"​","style":"IPY_MODEL_54a06fe920a24ab297a91603b6d46c5e","value":""}},"e9b0e212bb894121b28e1c4fdc17f50d":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ea687b4ac76847f49f8bab2f61d4d326":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ed55ca8a0e484319a3751a0708c8c948":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f076624978454011a3b8294b169fed15":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fac7b5ac8c4e48f697dab61308f92f2f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"fc64036223c84f9c9950d815a56b5a4c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"fe4838d1490e40da87d267f8229d96e1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"","description":"","description_tooltip":null,"layout":"IPY_MODEL_9da81a911caf41479a3e1ef2bdabf25c","max":20,"min":0,"orientation":"horizontal","style":"IPY_MODEL_8fb130c860914a9a95a479f9ad3721fd","value":0}},"feffb03d858149bda0e01a7bd2f7bb30":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_5c7c7ea87af8477d947de6cce5ad87ab","placeholder":"​","style":"IPY_MODEL_fc64036223c84f9c9950d815a56b5a4c","value":""}}},"version_major":2,"version_minor":0}
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>